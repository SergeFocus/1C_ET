//sza140617-1357 Хозяин: 
//sza131111-1845

&НаСервере
Функция   ЕстьПользователи() Экспорт	
	Возврат НЕ ПользователиИнформационнойБазы.ПолучитьПользователей().Количество() = 0;	
КонецФункции //ЕстьПользователи

&НаСервере
процедура ОбновитьДанныеПриОбновленииКонфигурации(Знач ВерсияБыла, Знач ВерсияКонфигурации) Экспорт
	
	попытка
		установитьМонопольныйРежим(Истина);
	исключение
	конецпопытки;
	
	ПараметрыСеанса.НеВыводитьСообщений = Истина;
	
	ДокументыДляПерепроведения = Новый Массив;
	ТаблицаДокументовДляПерепроведения = новый ТаблицаЗначений;
	ТаблицаДокументовДляПерепроведения.Колонки.Добавить("Документ");
	ТаблицаДокументовДляПерепроведения.Колонки.Добавить("Дата");
	
	ВерсияБыла = стрзаменить(ВерсияБыла, "F", "");
	Попытка 
		ВерсияБыла = Число(?(ВерсияБыла = "", "0", ВерсияБыла));
	Исключение 	
		ВерсияБыла = 0;
	КонецПопытки;
	Попытка 
		ВерсияКонфигурации 	= Число(стрзаменить(ВерсияКонфигурации, "F", ""));
	Исключение 	
		ВерсияКонфигурации 	= 0;
	КонецПопытки;
	
	Если ОбщийМодульПовтор.получитьЗначениеНастройкиИлиКонстанты("ПоддерживатьИныеЯзыкиКромеРусского") Тогда
		Язык = Справочники.Языки.Выбрать() ;
		пока язык.Следующий() Цикл
			
			ЭтотЯзык = язык.Ссылка;
			Если не ЭтотЯзык = Справочники.Языки.Русский 
				и не ОбщийМодульТекстСервер.НетНиОднойЗаписиЭтогоЯзыка(ЭтотЯзык) Тогда
				
				ОбщийМодульТекстСервер.ЗагрузитьТекстыЯзыкаИзМакета("Макет" + ЭтотЯзык.Код, ЭтотЯзык, Истина);
			КонецЕсли;	
		КонецЦикла;	
		
		Если версияБыла < 140611 Тогда
			ЭлементСправочника = ПредопределенноеЗначение("Справочник.СтатьиДвиженияДенег.ОплатаКомиссионногоВознаграждения").ПолучитьОбъект();
			ЭлементСправочника.Наименование = ОбщийМодульПовтор.ПолучитьТекстНаЯзыке(ЭлементСправочника.Наименование) ;
			ЭлементСправочника.Записать();
			
			ЭлементСправочника = ПредопределенноеЗначение("Справочник.СтатьиДвиженияДенег.СменаФормыОплаты").ПолучитьОбъект();
			ЭлементСправочника.Наименование = ОбщийМодульПовтор.ПолучитьТекстНаЯзыке(ЭлементСправочника.Наименование) ;
			ЭлементСправочника.Записать();		
		КонецЕсли;
		
	КонецЕсли;
	
	Если версияБыла < 140617 Тогда
		Если НЕ ОбщийМодульПовтор.получитьЗначениеНастройкиИлиКонстанты("ВестиУчетДенегВНесколькихХранилищах") 
			И ОбщийМодульПовтор.получитьЗначениеНастройкиИлиКонстанты("ВестиУчетВалют") Тогда
			
			ОсновнаяВалюта = ПредопределенноеЗначение("Справочник.Валюты.ОсновнаяВалюта");
			
			Запрос = Новый Запрос;
			Запрос.Текст = "ВЫБРАТЬ ПЕРВЫЕ 1 ХранилищаДенег.Ссылка
			|ИЗ Справочник.ХранилищаДенег КАК ХранилищаДенег
			|ГДЕ ХранилищаДенег.Валюта = &Валюта";
			
			Валюты = справочники.Валюты.Выбрать();
			Пока Валюты.Следующий() Цикл
				Если Не Валюты.Предопределенный Тогда
					Запрос.УстановитьПараметр("Валюта", Валюты.Ссылка);
					
					РезультатЗапроса = Запрос.Выполнить();
					Если РезультатЗапроса.Пустой() Тогда
						
						НовоеХранилищеДенег = Справочники.ХранилищаДенег.СоздатьЭлемент();
						НовоеХранилищеДенег.Валюта = Валюты.Ссылка;
						НовоеХранилищеДенег.Наименование = ОбщийМодульПовтор.ПолучитьТекстНаЯзыке("Основное в валюте") + " " + СокрЛП(Валюты.Ссылка);
						НовоеХранилищеДенег.Записать();
					КонецЕсли;	
				КонецЕсли;	
			КонецЦикла;
			
			Запрос = Новый Запрос;
			Запрос.Текст = "ВЫБРАТЬ ДвиженияДенег.Ссылка,
			|	ДвиженияДенег.Дата КАК Дата
			|ИЗ Документ.ДвиженияДенег КАК ДвиженияДенег
			|ГДЕ ДвиженияДенег.Проведен = ИСТИНА
			|	И ДвиженияДенег.Валюта <> &Валюта
			|ОБЪЕДИНИТЬ ВСЕ
			|ВЫБРАТЬ Инвентаризации.Ссылка,
			|	Инвентаризации.Дата
			|ИЗ Документ.Инвентаризации КАК Инвентаризации
			|ГДЕ Инвентаризации.Проведен = ИСТИНА
			|	И Инвентаризации.Валюта <> &Валюта
			|ОБЪЕДИНИТЬ ВСЕ
			|ВЫБРАТЬ ПоступленияТовара.Ссылка,
			|	ПоступленияТовара.Дата
			|ИЗ Документ.ПоступленияТовара КАК ПоступленияТовара
			|ГДЕ ПоступленияТовара.Проведен = ИСТИНА
			|	И ПоступленияТовара.Валюта <> &Валюта
			|ОБЪЕДИНИТЬ ВСЕ
			|ВЫБРАТЬ РасходыТовара.Ссылка,
			|	РасходыТовара.Дата
			|ИЗ Документ.РасходыТовара КАК РасходыТовара
			|ГДЕ РасходыТовара.Проведен = ИСТИНА
			|	И РасходыТовара.Валюта <> &Валюта
			|ОБЪЕДИНИТЬ ВСЕ
			|ВЫБРАТЬ ОказанияУслугЗаВремя.Ссылка,
			|	ОказанияУслугЗаВремя.Дата
			|ИЗ Документ.ОказанияУслугЗаВремя КАК ОказанияУслугЗаВремя
			|ГДЕ ОказанияУслугЗаВремя.Проведен = ИСТИНА
			|	И ОказанияУслугЗаВремя.Валюта <> &Валюта
			|ОБЪЕДИНИТЬ ВСЕ
			|ВЫБРАТЬ ВыполненияРабот.Ссылка,
			|	ВыполненияРабот.Дата
			|ИЗ Документ.ВыполненияРабот КАК ВыполненияРабот
			|ГДЕ ВыполненияРабот.Проведен = ИСТИНА
			|	И ВыполненияРабот.Валюта <> &Валюта
			|УПОРЯДОЧИТЬ ПО Дата";
			
			Запрос.УстановитьПараметр("Валюта", ОсновнаяВалюта);
			
			РезультатЗапроса = Запрос.Выполнить();
			Если НЕ РезультатЗапроса.Пустой() тогда
				ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
				
				Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
					
					Регистратор = ВыборкаДетальныеЗаписи.Ссылка;
					РегистраторОбъект = Регистратор.ПолучитьОбъект();
					РегистраторОбъект.ХранилищеДенег = ОбщийМодульПовтор.ПолучитьАвтоХранилищеДенегПоВалюте(Регистратор.Валюта, РегистраторОбъект.ХранилищеДенег);
					РегистраторОбъект.НеПроводить = Истина;
					РегистраторОбъект.Записать(РежимЗаписиДокумента.Проведение, РежимПроведенияДокумента.Неоперативный);
					Регистратор = РегистраторОбъект.Ссылка;
					Если ДокументыДляПерепроведения.Найти(Регистратор) = Неопределено Тогда
						ДокументыДляПерепроведения.Добавить(Регистратор);
						СтрокаДокумент = ТаблицаДокументовДляПерепроведения.Добавить();
						СтрокаДокумент.Документ = Регистратор;
						СтрокаДокумент.Дата = ВыборкаДетальныеЗаписи.Дата;
					КонецЕсли;
					
				КонецЦикла;
			КонецЕсли;
			
			Запрос = Новый Запрос;
			Запрос.Текст = "ВЫБРАТЬ РАЗЛИЧНЫЕ КорректировкиИРегистрацияОстатковДеньги.Ссылка, КорректировкиИРегистрацияОстатковДеньги.Ссылка.Дата
			               |ИЗ Документ.КорректировкиИРегистрацияОстатков.Деньги КАК КорректировкиИРегистрацияОстатковДеньги
			               |ГДЕ КорректировкиИРегистрацияОстатковДеньги.Валюта <> &Валюта
			               |	И КорректировкиИРегистрацияОстатковДеньги.Ссылка.Проведен = ИСТИНА";
			
			Запрос.УстановитьПараметр("Валюта", ОсновнаяВалюта);
			
			РезультатЗапроса = Запрос.Выполнить();
			Если НЕ РезультатЗапроса.Пустой() тогда
				ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
				
				Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
					
					Регистратор = ВыборкаДетальныеЗаписи.Ссылка;
					РегистраторОбъект = Регистратор.ПолучитьОбъект();
					Для Каждого СтрокаДенег Из РегистраторОбъект.Деньги Цикл
						Если НЕ СтрокаДенег.Валюта = ОсновнаяВалюта Тогда
							СтрокаДенег.ХранилищеДенег = ОбщийМодульПовтор.ПолучитьАвтоХранилищеДенегПоВалюте(СтрокаДенег.Валюта, СтрокаДенег.ХранилищеДенег);	
						КонецЕсли;	
					КонецЦикла;
					РегистраторОбъект.НеПроводить = Истина;
					РегистраторОбъект.Записать(РежимЗаписиДокумента.Проведение, РежимПроведенияДокумента.Неоперативный);
					Регистратор = РегистраторОбъект.Ссылка;
					Если ДокументыДляПерепроведения.Найти(Регистратор) = Неопределено Тогда
						ДокументыДляПерепроведения.Добавить(Регистратор);
						СтрокаДокумент = ТаблицаДокументовДляПерепроведения.Добавить();
						СтрокаДокумент.Документ = Регистратор;
						СтрокаДокумент.Дата = ВыборкаДетальныеЗаписи.Дата;
					КонецЕсли;
					
				КонецЦикла;
			КонецЕсли;
			
			Запрос = Новый Запрос;
			Запрос.Текст = "ВЫБРАТЬ РАЗЛИЧНЫЕ ДвиженияДенегПлатежи.Ссылка,
			               |	ДвиженияДенегПлатежи.Ссылка.Дата КАК Дата
			               |ИЗ Документ.ДвиженияДенег.Платежи КАК ДвиженияДенегПлатежи
			               |ГДЕ ДвиженияДенегПлатежи.Валюта <> &Валюта
			               |	И ДвиженияДенегПлатежи.Ссылка.Проведен = ИСТИНА
			               |ОБЪЕДИНИТЬ ВСЕ
			               |ВЫБРАТЬ РАЗЛИЧНЫЕ ДвиженияДенегЗарплата.Ссылка,
			               |	ДвиженияДенегЗарплата.Ссылка.Дата
			               |ИЗ Документ.ДвиженияДенег.Зарплата КАК ДвиженияДенегЗарплата
			               |ГДЕ ДвиженияДенегЗарплата.Валюта <> &Валюта
			               |	И ДвиженияДенегЗарплата.Ссылка.Проведен = ИСТИНА";
			
			Запрос.УстановитьПараметр("Валюта", ОсновнаяВалюта);
			
			РезультатЗапроса = Запрос.Выполнить();
			Если НЕ РезультатЗапроса.Пустой() тогда
				ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
				
				Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
					
					Регистратор = ВыборкаДетальныеЗаписи.Ссылка;
					РегистраторОбъект = Регистратор.ПолучитьОбъект();
					Для Каждого СтрокаДенег Из РегистраторОбъект.Платежи Цикл
						Если НЕ СтрокаДенег.Валюта = ОсновнаяВалюта Тогда
							СтрокаДенег.ХранилищеДенег = ОбщийМодульПовтор.ПолучитьАвтоХранилищеДенегПоВалюте(СтрокаДенег.Валюта, СтрокаДенег.ХранилищеДенег);	
						КонецЕсли;	
					КонецЦикла;
					Для Каждого СтрокаДенег Из РегистраторОбъект.Зарплата Цикл
						Если НЕ СтрокаДенег.Валюта = ОсновнаяВалюта Тогда
							СтрокаДенег.ХранилищеДенег = ОбщийМодульПовтор.ПолучитьАвтоХранилищеДенегПоВалюте(СтрокаДенег.Валюта, СтрокаДенег.ХранилищеДенег);	
						КонецЕсли;	
					КонецЦикла;
					РегистраторОбъект.НеПроводить = Истина;
					РегистраторОбъект.Записать(РежимЗаписиДокумента.Проведение, РежимПроведенияДокумента.Неоперативный);
					Регистратор = РегистраторОбъект.Ссылка;
					Если ДокументыДляПерепроведения.Найти(Регистратор) = Неопределено Тогда
						ДокументыДляПерепроведения.Добавить(Регистратор);
						СтрокаДокумент = ТаблицаДокументовДляПерепроведения.Добавить();
						СтрокаДокумент.Документ = Регистратор;
						СтрокаДокумент.Дата = ВыборкаДетальныеЗаписи.Дата;
					КонецЕсли;
					
				КонецЦикла;
			КонецЕсли;
		КонецЕсли;
	КонецЕсли;
	
	Если версияБыла < 140402 Тогда
		Константы.НаименованиеОсновнойЕдиницыИзмеренияПоУмолчанию.Установить(ОбщийМодульПовтор.ПолучитьТекстНаЯзыке("Шт."));
		Если Не ОбщийМодульТекстСервер.ТекущийЯзыкРусский() Тогда
			ЭлементСправочника = Справочники.Спецификации.Архив.ПолучитьОбъект();
			ЭлементСправочника.Наименование = ОбщийМодульПовтор.ПолучитьТекстНаЯзыке(ЭлементСправочника.Наименование) ;
			ЭлементСправочника.Комментарий = ОбщийМодульПовтор.ПолучитьТекстНаЯзыке("Для неактуальных Спецификаций для комплектаций") ;
			ЭлементСправочника.Записать();	                         
		КонецЕсли;
	КонецЕсли;
	
	если ВерсияБыла < 131117 тогда
		
		НашеЮрЛицо = Справочники.Организации.ОсновноеПредприятие.ПолучитьОбъект();
		Наименование = ОбщийМодульПовтор.получитьЗначениеНастройкиИлиКонстанты("ТекстВШапкеДокументовПриПечати");
		если ЗначениеЗаполнено(Наименование) ТОгда
			НашеЮрЛицо.Наименование = стрзаменить(Наименование, символы.ПС, " ");
		иначе
			НашеЮрЛицо.Наименование = ОбщийМодульПовтор.ПолучитьТекстНаЯзыке("Основная организация");
		КонецЕсли;
		НашеЮрЛицо.ВидЦен 		    = Справочники.ВидыЦен.ОсновнойВидЦен ;
		НашеЮрЛицо.ЭлектроннаяПочта = ОбщийМодульПовтор.получитьЗначениеНастройкиИлиКонстанты("ЭлектроннаяПочтаОтправитель");
		НашеЮрЛицо.Записать();
		
		Если Не ОбщийМодульТекстСервер.ТекущийЯзыкРусский() Тогда
			ЭлементСправочника = Справочники.Договора.Архив.ПолучитьОбъект();
			ЭлементСправочника.Наименование = ОбщийМодульПовтор.ПолучитьТекстНаЯзыке(ЭлементСправочника.Наименование) ;
			ЭлементСправочника.Комментарий = ОбщийМодульПовтор.ПолучитьТекстНаЯзыке("Для неактуальных Договоров") ;
			ЭлементСправочника.Записать();	                         
		КонецЕсли;
		
		Запрос = Новый Запрос;
		Запрос.Текст = "ВЫБРАТЬ РАЗЛИЧНЫЕ Продажи.Регистратор, Продажи.Период КАК Период
		|ИЗ РегистрНакопления.Продажи КАК Продажи
		|ОБЪЕДИНИТЬ ВСЕ
		|ВЫБРАТЬ РАЗЛИЧНЫЕ Закупки.Регистратор, Закупки.Период
		|ИЗ РегистрНакопления.Закупки КАК Закупки
		|УПОРЯДОЧИТЬ ПО Период";
		
		РезультатЗапроса = Запрос.Выполнить();
		
		Если НЕ РезультатЗапроса.Пустой() ТОгда
			ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
			
			Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
				
				Регистратор = ВыборкаДетальныеЗаписи.Регистратор;
				Если ДокументыДляПерепроведения.Найти(Регистратор) = Неопределено Тогда
					ДокументыДляПерепроведения.Добавить(Регистратор);
					СтрокаДокумент = ТаблицаДокументовДляПерепроведения.Добавить();
					СтрокаДокумент.Документ = Регистратор;
					СтрокаДокумент.Дата = ВыборкаДетальныеЗаписи.Период;
				КонецЕсли;
				
			КонецЦикла;	
		КонецЕсли;
		
		ЯзыкР = Справочники.Языки.Болгарский.ПолучитьОбъект();
		ЯзыкР.Комментарий 	= "Български BG";
		ЯзыкР.Наименование 	= "Български - Болгарский (BG)";
		ЯзыкР.Записать();
		
		ЯзыкР = Справочники.Языки.Казахский.ПолучитьОбъект();
		ЯзыкР.Комментарий 	= "Қазақ BL";
		ЯзыкР.Наименование 	= "Қазақ - Казахский (KK)";
		ЯзыкР.Записать();
		
		ЯзыкР = Справочники.Языки.Немецкий.ПолучитьОбъект();
		ЯзыкР.Комментарий 	= "Deutsch DE";
		ЯзыкР.Наименование 	= "Deutsch - Немецкий (DE)";
		ЯзыкР.Записать();
		
		ЯзыкР = Справочники.Языки.Польский.ПолучитьОбъект();
		ЯзыкР.Комментарий 	= "Polski PL";
		ЯзыкР.Наименование 	= "Polski - Польский (PL)";
		ЯзыкР.Записать();
		
	конецесли;
	
	Если ВерсияБыла < 131119 Тогда
		Константы.ИспользоватьКомандыИзмененийИЗаполненияДляТаблицыТовары.Установить(истина);
	КонецЕсли;
	
	Если ВерсияБыла < 131125 Тогда
		Константы.ИспользоватьРегистрациюПриемаИВыдачиДенегПрямоВДокументахРасходаИПрихода.Установить(Истина);
	КонецЕсли;
	
	Если ВерсияБыла < 131127 Тогда
		ЯзыкР = Справочники.Языки.Тайский.ПолучитьОбъект();
		ЯзыкР.Комментарий 	= "ภาษาไทย  TH";
		ЯзыкР.Наименование 	= "ภาษาไทย - Тайский (TH)";
		ЯзыкР.Записать();
	КонецЕсли;
	
	Если ВерсияБыла < 131204 Тогда
		Константы.ОрганизацияПоУмолчанию.Установить(ОбщийМодульПовтор.ЗначениеПредопределенного("Справочники.Организации.ОсновноеПредприятие")) ;	
		
		ОсновнаяКассаВОсновнойВалюте = Справочники.ХранилищаДенег.ОсновнаяКассаВОсновнойВалюте.ПолучитьОбъект();
		ОсновнаяКассаВОсновнойВалюте.Наименование = ОбщийМодульПовтор.ПолучитьТекстНаЯзыке(ОсновнаяКассаВОсновнойВалюте.Наименование) ;
		ОсновнаяКассаВОсновнойВалюте.Валюта 	  = ОбщийМодульПовтор.ЗначениеПредопределенного("Справочники.Валюты.ОсновнаяВалюта");
		ОсновнаяКассаВОсновнойВалюте.ФормаОплаты  = перечисления.ФормыОплаты.Наличные;
		ОсновнаяКассаВОсновнойВалюте.Записать();
		
		Константы.ОсновноеХранилищеДенег.Установить(ОсновнаяКассаВОсновнойВалюте.Ссылка);
		
		Если Не ОбщийМодульТекстСервер.ТекущийЯзыкРусский() Тогда
			ВидХарактеристик = ПланыВидовХарактеристик.НастройкиПользователей.Выбрать();
			Пока ВидХарактеристик.Следующий() Цикл
				ОбъектХарактеристика = ВидХарактеристик.ПолучитьОбъект();
				ОбъектХарактеристика.Наименование = ОбщийМодульПовтор.ПолучитьТекстНаЯзыке(ВидХарактеристик.Наименование) ;
				ОбъектХарактеристика.Записать();
			КонецЦикла;
			
			СтатьяДенег = Справочники.СтатьиДвиженияДенег.ВнутреннееПеремещениеДенег.ПолучитьОбъект();
			СтатьяДенег.Наименование = ОбщийМодульПовтор.ПолучитьТекстНаЯзыке(СтатьяДенег.Наименование) ;
			СтатьяДенег.Записать();
		КонецЕсли;
		
	КонецЕсли;
	
	Если ВерсияБыла < 140227 
		И Не ОбщийМодульТекстСервер.ТекущийЯзыкРусский() Тогда
		
		ЭлементСправочника = Справочники.ВидыДокументаСертификатаИлиГигиеническогоЗаключения.ГигиеническоеЗаключениеОбыкновенное.ПолучитьОбъект();
		ЭлементСправочника.Наименование = ОбщийМодульПовтор.ПолучитьТекстНаЯзыке(ЭлементСправочника.Наименование) ;
		ЭлементСправочника.Записать();
		
		ЭлементСправочника = Справочники.ВидыДокументаСертификатаИлиГигиеническогоЗаключения.ИнформационноеПисьмо.ПолучитьОбъект();
		ЭлементСправочника.Наименование = ОбщийМодульПовтор.ПолучитьТекстНаЯзыке(ЭлементСправочника.Наименование) ;
		ЭлементСправочника.Записать();
		
		ЭлементСправочника = Справочники.ВидыДокументаСертификатаИлиГигиеническогоЗаключения.СертификатОбыкновенный.ПолучитьОбъект();
		ЭлементСправочника.Наименование = ОбщийМодульПовтор.ПолучитьТекстНаЯзыке(ЭлементСправочника.Наименование) ;
		ЭлементСправочника.Записать();	
	КонецЕсли;
	
	Если ВерсияБыла < 131215 Тогда
		Константы.ИспользоватьПечатьЭтикеток.Установить(Истина); ;
	КонецЕсли;
	
	если ВерсияБыла < 131219 Тогда
		
		Запрос = Новый Запрос;
		Запрос.Текст = "ВЫБРАТЬ Изображения.Ссылка, Изображения.СвязанныйОбъект ИЗ Справочник.Изображения КАК Изображения";
		
		РезультатЗапроса = Запрос.Выполнить();
		если не РезультатЗапроса.Пустой() тогда
			ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
			МассивОбъектов = Новый Массив;
			Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
				
				СвязанныйОбъект = ВыборкаДетальныеЗаписи.СвязанныйОбъект;
				если МассивОбъектов.Найти(СвязанныйОбъект) = Неопределено тогда
					МассивОбъектов.Добавить(СвязанныйОбъект);
					Изображение = ВыборкаДетальныеЗаписи.Ссылка.ПолучитьОбъект();
					Изображение.ЭтоОсновноеИзображениеОбъекта = Истина;	
					Изображение.Записать();
				КонецЕсли;
			КонецЦикла;                        	
		КонецЕсли;
		
	КонецЕсли;
	
	если ВерсияБыла < 140103 тогда
		
		Запрос = Новый Запрос;
		Запрос.Текст = "ВЫБРАТЬ ДвиженияДенег.Ссылка, ДвиженияДенег.Дата КАК Дата
		|ИЗ Документ.ДвиженияДенег КАК ДвиженияДенег
		|ГДЕ ДвиженияДенег.Проведен = ИСТИНА
		|ОБЪЕДИНИТЬ ВСЕ
		|ВЫБРАТЬ Инвентаризации.Ссылка, Инвентаризации.Дата
		|ИЗ Документ.Инвентаризации КАК Инвентаризации
		|ГДЕ Инвентаризации.Проведен = ИСТИНА
		|ОБЪЕДИНИТЬ ВСЕ
		|ВЫБРАТЬ КорректировкиИРегистрацияОстатков.Ссылка, КорректировкиИРегистрацияОстатков.Дата
		|ИЗ Документ.КорректировкиИРегистрацияОстатков КАК КорректировкиИРегистрацияОстатков
		|ГДЕ КорректировкиИРегистрацияОстатков.Проведен = ИСТИНА
		|ОБЪЕДИНИТЬ ВСЕ
		|ВЫБРАТЬ ПоступленияТовара.Ссылка, ПоступленияТовара.Дата
		|ИЗ Документ.ПоступленияТовара КАК ПоступленияТовара
		|ГДЕ ПоступленияТовара.Проведен = ИСТИНА
		|ОБЪЕДИНИТЬ ВСЕ
		|ВЫБРАТЬ РасходыТовара.Ссылка, РасходыТовара.Дата
		|ИЗ Документ.РасходыТовара КАК РасходыТовара
		|ГДЕ РасходыТовара.Проведен = ИСТИНА
		|УПОРЯДОЧИТЬ ПО Дата";
		
		РезультатЗапроса = Запрос.Выполнить();
		Если НЕ РезультатЗапроса.Пустой() тогда
			ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
			
			Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
				
				Регистратор = ВыборкаДетальныеЗаписи.Ссылка;
				Если ДокументыДляПерепроведения.Найти(Регистратор) = Неопределено Тогда
					ДокументыДляПерепроведения.Добавить(Регистратор);
					СтрокаДокумент = ТаблицаДокументовДляПерепроведения.Добавить();
					СтрокаДокумент.Документ = Регистратор;
					СтрокаДокумент.Дата = ВыборкаДетальныеЗаписи.Дата;
				КонецЕсли;
				
			КонецЦикла;
		КонецЕсли;
		
		Константы.ПоддерживатьНаименованияНаДругихЯзыкахКромеРусского.Установить(Константы.ПоддерживатьИныеЯзыкиКромеРусского.Получить());
		
	КонецЕсли;
	
	МассивПартий = новый Массив;
	если ВерсияБыла < 140108 тогда
		
		Запрос = Новый Запрос;
		Запрос.Текст = "ВЫБРАТЬ ПоступленияТовара.Ссылка,
		|	ПоступленияТовара.Дата КАК Дата,
		|	ПоступленияТовара.ПартияПриобретения
		|ИЗ Документ.ПоступленияТовара КАК ПоступленияТовара
		|ГДЕ ПоступленияТовара.ПартияПриобретения <> &ПустаяПартияПриобретения
		|	И ПоступленияТовара.Проведен = ИСТИНА
		|УПОРЯДОЧИТЬ ПО Дата";
		
		Запрос.УстановитьПараметр("ПустаяПартияПриобретения", Справочники.ПартииПриобретения.ПустаяСсылка());
		
		РезультатЗапроса = Запрос.Выполнить();
		если не РезультатЗапроса.Пустой() тогда
			ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
			
			пока ВыборкаДетальныеЗаписи.Следующий() Цикл
				
				Регистратор = ВыборкаДетальныеЗаписи.Ссылка;
				Если ДокументыДляПерепроведения.Найти(Регистратор) = Неопределено Тогда
					ДокументыДляПерепроведения.Добавить(Регистратор);
					СтрокаДокумент = ТаблицаДокументовДляПерепроведения.Добавить();
					СтрокаДокумент.Документ = Регистратор;
					СтрокаДокумент.Дата = ВыборкаДетальныеЗаписи.Дата;
				КонецЕсли;
				
				Если МассивПартий.Найти(ВыборкаДетальныеЗаписи.ПартияПриобретения) = Неопределено Тогда
					МассивПартий.Добавить(ВыборкаДетальныеЗаписи.ПартияПриобретения);
				КонецЕсли;
			КонецЦикла;
			
		КонецЕсли;	
	КонецЕсли;
	
	если ВерсияБыла < 140209 тогда 
		
		Запрос = Новый Запрос;
		Запрос.Текст = "ВЫБРАТЬ ПоступленияТовара.Ссылка,
		|	ПоступленияТовара.Дата КАК Дата
		|ИЗ Документ.ПоступленияТовара КАК ПоступленияТовара
		|ГДЕ ПоступленияТовара.Проведен = ИСТИНА
		|ОБЪЕДИНИТЬ ВСЕ
		|ВЫБРАТЬ РасходыТовара.Ссылка,
		|	РасходыТовара.Дата
		|ИЗ Документ.РасходыТовара КАК РасходыТовара
		|ГДЕ РасходыТовара.Проведен = ИСТИНА
		|ОБЪЕДИНИТЬ ВСЕ
		|ВЫБРАТЬ ВыполненияРабот.Ссылка,
		|	ВыполненияРабот.Дата
		|ИЗ Документ.ВыполненияРабот КАК ВыполненияРабот
		|ГДЕ ВыполненияРабот.Проведен = ИСТИНА
		|УПОРЯДОЧИТЬ ПО Дата";
		
		РезультатЗапроса = Запрос.Выполнить();
		если не РезультатЗапроса.Пустой() тогда
			ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
			
			Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
				
				Регистратор = ВыборкаДетальныеЗаписи.Ссылка;
				Если ДокументыДляПерепроведения.Найти(Регистратор) = Неопределено Тогда
					ДокументыДляПерепроведения.Добавить(Регистратор);
					СтрокаДокумент = ТаблицаДокументовДляПерепроведения.Добавить();
					СтрокаДокумент.Документ = Регистратор;
					СтрокаДокумент.Дата = ВыборкаДетальныеЗаписи.Дата;
				КонецЕсли;
				
			КонецЦикла;
		КонецЕсли;
		
	КонецЕсли;	
	
	Если ВерсияБыла < 140510 тогда 
		
		Запрос = Новый Запрос;
		Запрос.Текст = "ВЫБРАТЬ ПоступленияТовара.Ссылка,
		|	ПоступленияТовара.Дата КАК Дата
		|ИЗ Документ.ПоступленияТовара КАК ПоступленияТовара
		|ГДЕ ПоступленияТовара.Проведен = ИСТИНА
		|	И ПоступленияТовара.ЭтоЗаказ = ЛОЖЬ
		|ОБЪЕДИНИТЬ ВСЕ
		|ВЫБРАТЬ РасходыТовара.Ссылка,
		|	РасходыТовара.Дата
		|ИЗ Документ.РасходыТовара КАК РасходыТовара
		|ГДЕ РасходыТовара.Проведен = ИСТИНА
		|	И РасходыТовара.ЭтоЗаказ = ЛОЖЬ
		|УПОРЯДОЧИТЬ ПО Дата";
		
		РезультатЗапроса = Запрос.Выполнить();
		Если НЕ РезультатЗапроса.Пустой() Тогда
			ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
			
			Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
				
				Регистратор = ВыборкаДетальныеЗаписи.Ссылка;
				Если ДокументыДляПерепроведения.Найти(Регистратор) = Неопределено Тогда
					ДокументыДляПерепроведения.Добавить(Регистратор);
					СтрокаДокумент = ТаблицаДокументовДляПерепроведения.Добавить();
					СтрокаДокумент.Документ = Регистратор;
					СтрокаДокумент.Дата = ВыборкаДетальныеЗаписи.Дата;
				КонецЕсли;
				
			КонецЦикла;
		КонецЕсли;
		
	КонецЕсли;	
	
	Если ВерсияБыла < 140606 
		и Константы.ВестиУчетВаловойПрибыли.Получить() тогда 
		
		Запрос = Новый Запрос;      //ВОЗВРАТЫ-Валовая прибыль
		Запрос.Текст = "ВЫБРАТЬ ПоступленияТовара.Ссылка,
		|	ПоступленияТовара.Дата КАК Дата,
		|	ПоступленияТовара.КлиентПоставщик
		|ИЗ Документ.ПоступленияТовара КАК ПоступленияТовара
		|ГДЕ ПоступленияТовара.Проведен = ИСТИНА
		|	И ПоступленияТовара.ЭтоЗаказ = ЛОЖЬ";
		
		РезультатЗапроса = Запрос.Выполнить();
		Если НЕ РезультатЗапроса.Пустой() Тогда
			ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
			
			Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
				
				КлиентПоставщик = ВыборкаДетальныеЗаписи.КлиентПоставщик;
				Если ЗначениеЗаполнено(КлиентПоставщик)
					и ТипЗнч(КлиентПоставщик) = Тип("СправочникСсылка.Клиенты") Тогда
					
					Регистратор = ВыборкаДетальныеЗаписи.Ссылка;
					
					Если ДокументыДляПерепроведения.Найти(Регистратор) = Неопределено Тогда
						ДокументыДляПерепроведения.Добавить(Регистратор);
						СтрокаДокумент = ТаблицаДокументовДляПерепроведения.Добавить();
						СтрокаДокумент.Документ = Регистратор;
						СтрокаДокумент.Дата = ВыборкаДетальныеЗаписи.Дата;
					КонецЕсли;
				КонецЕсли; 
			КонецЦикла;
		КонецЕсли;
	КонецЕсли;
	
	Если ВерсияБыла < 140531 тогда 
		
		Запрос = Новый Запрос;
		Запрос.Текст = "ВЫБРАТЬ ПоступленияТовара.Ссылка,
		|	ПоступленияТовара.Дата КАК Дата
		|ИЗ Документ.ПоступленияТовара КАК ПоступленияТовара
		|ГДЕ ПоступленияТовара.Проведен = ИСТИНА
		|	И ПоступленияТовара.ЭтоЗаказ = ЛОЖЬ
		|	И ПоступленияТовара.УДАЛИТЬ_СпособДоставки <> &ПустаяСтрока
		|ОБЪЕДИНИТЬ ВСЕ
		|ВЫБРАТЬ РасходыТовара.Ссылка,
		|	РасходыТовара.Дата
		|ИЗ Документ.РасходыТовара КАК РасходыТовара
		|ГДЕ РасходыТовара.Проведен = ИСТИНА
		|	И РасходыТовара.ЭтоЗаказ = ЛОЖЬ
		|	И РасходыТовара.УДАЛИТЬ_СпособДоставки <> &ПустаяСтрока
		|УПОРЯДОЧИТЬ ПО Дата";
		
		Запрос.УстановитьПараметр("ПустаяСтрока", "");
		РезультатЗапроса = Запрос.Выполнить();
		Если НЕ РезультатЗапроса.Пустой() Тогда
			ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
			
			Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
				
				Регистратор = ВыборкаДетальныеЗаписи.Ссылка;
				Если ДокументыДляПерепроведения.Найти(Регистратор) = Неопределено Тогда
					ДокументыДляПерепроведения.Добавить(Регистратор);
					СтрокаДокумент = ТаблицаДокументовДляПерепроведения.Добавить();
					СтрокаДокумент.Документ = Регистратор;
					СтрокаДокумент.Дата = ВыборкаДетальныеЗаписи.Дата;
				КонецЕсли;
				
			КонецЦикла;
		КонецЕсли;
		
		Запрос = Новый Запрос;
		Запрос.Текст = "ВЫБРАТЬ ПоступленияТовара.Ссылка,
		|	ПоступленияТовара.Дата КАК Дата
		|ИЗ Документ.ПоступленияТовара КАК ПоступленияТовара
		|ГДЕ ПоступленияТовара.Проведен = ИСТИНА
		|	И ПоступленияТовара.Договор.УстанавливаетСрокОплатыВДнях <> 0
		|ОБЪЕДИНИТЬ ВСЕ
		|ВЫБРАТЬ РасходыТовара.Ссылка,
		|	РасходыТовара.Дата
		|ИЗ Документ.РасходыТовара КАК РасходыТовара
		|ГДЕ РасходыТовара.Проведен = ИСТИНА
		|	И РасходыТовара.ЭтоЗаказ = ЛОЖЬ
		|	И РасходыТовара.Договор.УстанавливаетСрокОплатыВДнях <> 0
		|УПОРЯДОЧИТЬ ПО Дата";
		
		Запрос.УстановитьПараметр("ПустаяСтрока", "");
		РезультатЗапроса = Запрос.Выполнить();
		Если НЕ РезультатЗапроса.Пустой() Тогда
			ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
			
			Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
				
				Регистратор = ВыборкаДетальныеЗаписи.Ссылка;
				Если ДокументыДляПерепроведения.Найти(Регистратор) = Неопределено Тогда
					ДокументыДляПерепроведения.Добавить(Регистратор);
					СтрокаДокумент = ТаблицаДокументовДляПерепроведения.Добавить();
					СтрокаДокумент.Документ = Регистратор;
					СтрокаДокумент.Дата = ВыборкаДетальныеЗаписи.Дата;
				КонецЕсли;
				
			КонецЦикла;
		КонецЕсли;
		
	КонецЕсли;	
	
	Если ВерсияБыла < 140113 тогда 
		Константы.ИспользоватьЛичныеНастройкиПользователей.Установить(истина);
	КонецЕсли;
	
	если ВерсияБыла < 140117 тогда 
		
		Запрос = Новый Запрос;
		Запрос.Текст = "ВЫБРАТЬ РАЗЛИЧНЫЕ ПоступленияТовараДополнительныеРасходы.Ссылка,
		|	ПоступленияТовараДополнительныеРасходы.Ссылка.Дата КАК Дата
		|ИЗ Документ.ПоступленияТовара.ДополнительныеРасходы КАК ПоступленияТовараДополнительныеРасходы
		|ГДЕ ПоступленияТовараДополнительныеРасходы.Ссылка.Проведен = ИСТИНА
		|УПОРЯДОЧИТЬ ПО Дата";
		
		РезультатЗапроса = Запрос.Выполнить();
		если не РезультатЗапроса.Пустой() тогда
			ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
			
			Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
				
				Регистратор = ВыборкаДетальныеЗаписи.Ссылка;
				Если ДокументыДляПерепроведения.Найти(Регистратор) = Неопределено Тогда
					ДокументыДляПерепроведения.Добавить(Регистратор);
					СтрокаДокумент = ТаблицаДокументовДляПерепроведения.Добавить();
					СтрокаДокумент.Документ = Регистратор;
					СтрокаДокумент.Дата = ВыборкаДетальныеЗаписи.Дата;
				КонецЕсли;
				
			КонецЦикла;
		КонецЕсли;
		
	КонецЕсли;
	
	Если ВерсияБыла < 140426 
		И константы.ИспользоватьРегистрациюПриемаИВыдачиДенегПрямоВДокументахРасходаИПрихода.Получить()
		И константы.РазрешеноПриниматьПриРеализацииДеньгиСразуВНесколькихВалютах.Получить() Тогда
		
		Запрос = Новый Запрос;
		Запрос.Текст = "ВЫБРАТЬ РАЗЛИЧНЫЕ РасходыТовара.Ссылка,
		|	РасходыТовара.Ссылка.Дата КАК Дата
		|ИЗ Документ.РасходыТовара КАК РасходыТовара
		|ГДЕ РасходыТовара.Ссылка.Проведен = ИСТИНА
		|	И РасходыТовара.ПоступилоДенег <> 0
		|УПОРЯДОЧИТЬ ПО Дата";
		
		РезультатЗапроса = Запрос.Выполнить();
		если не РезультатЗапроса.Пустой() тогда
			ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
			
			Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
				
				Регистратор = ВыборкаДетальныеЗаписи.Ссылка;
				Если ДокументыДляПерепроведения.Найти(Регистратор) = Неопределено Тогда
					ДокументыДляПерепроведения.Добавить(Регистратор);
					СтрокаДокумент = ТаблицаДокументовДляПерепроведения.Добавить();
					СтрокаДокумент.Документ = Регистратор;
					СтрокаДокумент.Дата = ВыборкаДетальныеЗаписи.Дата;
				КонецЕсли;
				
			КонецЦикла;
		КонецЕсли;
	КонецЕсли;
	
	Если ВерсияБыла < 140119 тогда 
		Константы.ПриАвтоматическомПерепроведенииДокументовОтменитьПроверкиНаОтказ.Установить(Истина) ;
		ОбновитьПовторноИспользуемыеЗначения();
	КонецЕсли;
	
	Если ВерсияБыла < 140125 тогда 
		
		Запрос = Новый Запрос;
		Запрос.Текст = "ВЫБРАТЬ ПоступленияТовара.Ссылка,
		|	ПоступленияТовара.Дата КАК Дата
		|ИЗ Документ.ПоступленияТовара КАК ПоступленияТовара
		|ГДЕ ПоступленияТовара.Проведен = ИСТИНА
		|ОБЪЕДИНИТЬ ВСЕ
		|ВЫБРАТЬ РасходыТовара.Ссылка,
		|	РасходыТовара.Дата
		|ИЗ Документ.РасходыТовара КАК РасходыТовара
		|ГДЕ РасходыТовара.Проведен = ИСТИНА
		|УПОРЯДОЧИТЬ ПО Дата";
		
		РезультатЗапроса = Запрос.Выполнить();
		Если НЕ РезультатЗапроса.Пустой() тогда
			ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
			
			Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
				
				Регистратор = ВыборкаДетальныеЗаписи.Ссылка;
				Если ДокументыДляПерепроведения.Найти(Регистратор) = Неопределено Тогда
					ДокументыДляПерепроведения.Добавить(Регистратор);
					СтрокаДокумент = ТаблицаДокументовДляПерепроведения.Добавить();
					СтрокаДокумент.Документ = Регистратор;
					СтрокаДокумент.Дата = ВыборкаДетальныеЗаписи.Дата;
				КонецЕсли;
				
			КонецЦикла;
		КонецЕсли;
		
	КонецЕсли;
	
	Если ВерсияБыла < 140216 тогда
		
		Запрос = Новый Запрос;
		Запрос.Текст = "ВЫБРАТЬ ВыполненияРабот.Ссылка,
		|	ВыполненияРабот.Проведен,
		|	ВыполненияРабот.Дата
		|ИЗ Документ.ВыполненияРабот КАК ВыполненияРабот
		|ГДЕ ВыполненияРабот.БезПлана = ЛОЖЬ";
		
		РезультатЗапроса = Запрос.Выполнить();
		если не РезультатЗапроса.Пустой() тогда
			ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
			ОсновнаяВалюта = ПредопределенноеЗначение("Справочник.Валюты.ОсновнаяВалюта");
			
			Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
				Документ = ВыборкаДетальныеЗаписи.ссылка.ПолучитьОбъект();
				для каждого СтрокаТ из Документ.Товары Цикл
					
					Если не СтрокаТ.КоличествоПлан = СтрокаТ.Количество Тогда						
						СтрокаТ.КоличествоПлан = СтрокаТ.Количество;
					КонецЕсли;
					
					Если не СтрокаТ.ЦенаПлан = СтрокаТ.Цена Тогда
						СтрокаТ.ЦенаПлан = СтрокаТ.Цена;
					КонецЕсли;
					
					Если НЕ СтрокаТ.ПроцентСкидкиПлан = СтрокаТ.ПроцентСкидки Тогда
						СтрокаТ.ПроцентСкидкиПлан = СтрокаТ.ПроцентСкидки;
					КонецЕсли;
					
					Если НЕ СтрокаТ.СуммаБезСкидкиПлан = СтрокаТ.СуммаБезСкидки Тогда
						СтрокаТ.СуммаБезСкидкиПлан = СтрокаТ.СуммаБезСкидки;
					КонецЕсли;			
					
					Если СтрокаТ.Курс = 0 Тогда
						СтрокаТ.Курс = 1;
					КонецЕсли;
					
					Если СтрокаТ.КурсПлан = 0 Тогда
						СтрокаТ.КурсПлан = 1;
					КонецЕсли;
					
					Если НЕ ЗначениеЗаполнено(СтрокаТ.Валюта) Тогда
						СтрокаТ.Валюта = ОсновнаяВалюта;
					КонецЕсли;
					
					Если НЕ ЗначениеЗаполнено(СтрокаТ.ВалютаПлан) Тогда
						СтрокаТ.ВалютаПлан = ОсновнаяВалюта;
					КонецЕсли;
					
					если не СтрокаТ.Количество = 0
						и ЗначениеЗаполнено(СтрокаТ.Дата) Тогда
						
						СтрокаТ.ВаловаяПрибыль = ОбщийМодульСервер.РасчитатьОриентировочнуюВаловуюПрибыль(СтрокаТ.номенклатура, СтрокаТ.Количество, СтрокаТ.Дата, СтрокаТ.Сумма, СтрокаТ.Валюта, СтрокаТ.Курс);
					Иначе
						СтрокаТ.ВаловаяПрибыль = ОбщийМодульСервер.РасчитатьОриентировочнуюВаловуюПрибыль(СтрокаТ.номенклатура, СтрокаТ.КоличествоПлан, СтрокаТ.ДатаПлан, СтрокаТ.План, СтрокаТ.ВалютаПлан, СтрокаТ.КурсПлан);
					КонецЕсли;	
				КонецЦикла;
				
				для каждого СтрокаТ из Документ.Оплаты Цикл
					Если НЕ СтрокаТ.ВалютаПлан = СтрокаТ.Валюта Тогда
						СтрокаТ.ВалютаПлан = СтрокаТ.Валюта;
					КонецЕсли;
					Если НЕ СтрокаТ.КурсПлан = СтрокаТ.Курс Тогда
						СтрокаТ.КурсПлан = СтрокаТ.Курс;
					КонецЕсли;					
				КонецЦикла;
				
				для каждого СтрокаТ из Документ.Расходы Цикл
					
					Если НЕ СтрокаТ.ВалютаПлан = СтрокаТ.Валюта Тогда
						СтрокаТ.ВалютаПлан = СтрокаТ.Валюта;
					КонецЕсли;
					
					Если НЕ СтрокаТ.КурсПлан = СтрокаТ.Курс Тогда
						СтрокаТ.КурсПлан = СтрокаТ.Курс;
					КонецЕсли;					
					
				КонецЦикла;
				
				Если ВыборкаДетальныеЗаписи.проведен Тогда
					Документ.Записать(РежимЗаписиДокумента.Проведение);
					Регистратор = Документ.ссылка;
					
					Если ДокументыДляПерепроведения.Найти(Регистратор) = Неопределено Тогда
						ДокументыДляПерепроведения.Добавить(Регистратор);
						СтрокаДокумент = ТаблицаДокументовДляПерепроведения.Добавить();
						СтрокаДокумент.Документ = Регистратор;
						СтрокаДокумент.Дата = ВыборкаДетальныеЗаписи.Дата;
					КонецЕсли;
				Иначе
					Документ.Записать(РежимЗаписиДокумента.Запись);
				КонецЕсли;
			КонецЦикла;                        	
		КонецЕсли;
		
	КонецЕсли;
	
	//перепроведение
	Если не ДокументыДляПерепроведения.Количество() = 0 Тогда
		ТаблицаДокументовДляПерепроведения.Сортировать("Дата Возр");
		
		Для Каждого СтрокаДокумент Из ТаблицаДокументовДляПерепроведения Цикл
			ДокументОбъект = СтрокаДокумент.Документ.ПолучитьОбъект();
			
			Если ВерсияБыла < 140531 тогда
				СпособДоставки = ДокументОбъект.УДАЛИТЬ_СпособДоставки;
				Если НЕ СпособДоставки = "" Тогда
					ДокументОбъект.СпособДоставки = Справочники.СпособыДоставки.НайтиПоНаименованию(СпособДоставки);
					Если НЕ ЗначениеЗаполнено(ДокументОбъект.СпособДоставки) Тогда
						НовыйСпособДоставки = Справочники.СпособыДоставки.СоздатьЭлемент();
						НовыйСпособДоставки.Наименование = СпособДоставки;
						НовыйСпособДоставки.Записать();
						ДокументОбъект.СпособДоставки = НовыйСпособДоставки.Ссылка;
					КонецЕсли;
					
					ДокументОбъект.УДАЛИТЬ_СпособДоставки = "";
				КонецЕсли;
			КонецЕсли;
			ДокументОбъект.Записать(РежимЗаписиДокумента.Проведение);
		КонецЦикла;
	КонецЕсли;
	
	//	после проведения документов
	если ВерсияБыла < 140108 тогда
		Для каждого ПартияПриобретения Из МассивПартий Цикл
			ПартияПриобретенияОбъект = ПартияПриобретения.ПолучитьОбъект();
			ПартияПриобретенияОбъект.Записать();
		КонецЦикла;
	КонецЕсли;
	
	если ВерсияБыла < 140426 тогда
		Константы.ЕстьПринтер.Установить(Истина);
		Константы.ПравовойСтатусПоставщикаПоУмолчанию.Установить(Константы.ПравовойСтатусПоУмолчанию.Получить());
	КонецЕсли;
	
	Если ВерсияБыла < 140204 тогда
		
		СтрокаДубль = ОбщийМодульПовтор.ПолучитьТекстНаЯзыке("Дубль") + " ";
		
		Запрос = Новый Запрос;
		Запрос.Текст = "ВЫБРАТЬ Номенклатура.Ссылка
		|ИЗ Справочник.Номенклатура КАК Номенклатура
		|ГДЕ Номенклатура.Наименование ПОДОБНО &НаименованиеДубль";
		
		Запрос.УстановитьПараметр("НаименованиеДубль", СтрокаДубль);
		
		РезультатЗапроса = Запрос.Выполнить();
		Если НЕ РезультатЗапроса.Пустой() Тогда
			ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
			
			Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
				
				Номенклатура = ВыборкаДетальныеЗаписи.ссылка.ПолучитьОбъект();
				Номенклатура.Наименование = стрЗаменить(Номенклатура.Наименование, СтрокаДубль, "");
				Номенклатура.ОбменДанными.Загрузка = Истина;
				Номенклатура.ПометкаУдаления = Ложь;
				Номенклатура.Записать();
				
			КонецЦикла;	
		КонецЕсли;
		
	КонецЕсли;
	
	Если ВерсияБыла < 140420 
		И Константы.КоличествоНоменклатурыМожетБытьДробным.Получить() тогда 	
		
		Константы.ЧислоЗнаковПослеЗапятойДляКоличества.Установить(3);
	КонецЕсли;
	
	Если ВерсияБыла < 140418 тогда 	
		
		ПолныйДоступ = перечисления.УровниДоступа.ПолныйДоступ;
		Пользователи = Справочники.Пользователи.Выбрать();
		
		Пока Пользователи.Следующий() Цикл
			Пользователь = Пользователи.Ссылка.ПолучитьОбъект();
			Для Каждого СтрокаДоступа Из Пользователь.Доступ Цикл
				СтрокаДоступа.УровеньДоступа = ПолныйДоступ;
			КонецЦикла;
			
			Пользователь.Записать();			
		КонецЦикла;
	КонецЕсли;
	
	ОбновитьНаименованияПравПользователей(ВерсияБыла < 140426);
	
	ПараметрыСеанса.НеВыводитьСообщений = Ложь;
	Попытка
		установитьМонопольныйРежим(Ложь);
	Исключение
	КонецПопытки;
	
КонецПроцедуры

&НаСервере
Функция   СоздатьДоговор(Знач Организация, Знач КлиентПоставщик, Знач Дата, Знач ВидЦен = Неопределено) Экспорт
	
	НовыйДоговор = Справочники.Договора.СоздатьЭлемент() ;
	
	Если ЗначениеЗаполнено(ВидЦен) Тогда
		НовыйДоговор.ВидЦен = ВидЦен;          		
	Иначе
		
		Если ЗначениеЗаполнено(КлиентПоставщик) Тогда
			НовыйДоговор.ВидЦен = КлиентПоставщик.ВидЦен;
			
			Если НЕ ЗначениеЗаполнено(НовыйДоговор.ВидЦен) Тогда
				
				Если ТипЗнч(КлиентПоставщик) = Тип("СправочникСсылка.Клиенты") Тогда
					НовыйДоговор.ВидЦен = ОбщийМодульПовтор.получитьЗначениеНастройкиИлиКонстанты("ВидЦенРасходованияПоУмолчанию") ;
				Иначе
					НовыйДоговор.ВидЦен = ОбщийМодульПовтор.получитьЗначениеНастройкиИлиКонстанты("ВидЦенПриходованияТовараПоУмолчанию") ;
				КонецЕсли;
			КонецЕсли;
			
		ИначеЕсли ЗначениеЗаполнено(Организация) Тогда
			НовыйДоговор.ВидЦен = Организация.ВидЦен;
			
		КонецЕсли;
		
		Если НЕ ЗначениеЗаполнено(НовыйДоговор.ВидЦен) Тогда
			НовыйДоговор.ВидЦен = ОбщийМодульПовтор.ЗначениеПредопределенного("Справочники.ВидыЦен.ОсновнойВидЦен") ;
		КонецЕсли;	
	КонецЕсли;
	
	НовыйДоговор.ДатаЗаключения 	= НачалоДня(Дата);
	НовыйДоговор.КлиентПоставщик 	= КлиентПоставщик;
	НовыйДоговор.Комментарий 		= ОбщийМодульПовтор.ПолучитьТекстНаЯзыке("Создан автоматически");
	НовыйДоговор.НомерДоговора 		= ОбщийМодульПовтор.ПолучитьТекстНаЯзыке("по-умолчанию");
	НовыйДоговор.Организация 		= Организация;
	НовыйДоговор.УстанавливаетСрокОплатыВДнях = ОбщийМодульПовтор.получитьЗначениеНастройкиИлиКонстанты("СрокОплатыВДняхДляДоговоровПоУмолчанию");
	НовыйДоговор.Записать();
	
	Возврат НовыйДоговор.Ссылка;
	
КонецФункции

&НаСервере
Процедура ВыполнитьКод(Знач ПрограммныйКод) Экспорт
	Выполнить("" + ПрограммныйКод[0] + ";");	
КонецПроцедуры

&НаСервере
Процедура СохранитьВФайл(Знач ПараметрыСохранения) Экспорт
	
	ТабДок = ПараметрыСохранения[0];
	АдресФайла = ПараметрыСохранения[1] + "\" + ПараметрыСохранения[2] + ".xls";
	ТабДок.Записать(АдресФайла, ТипФайлаТабличногоДокумента.XLS97);
	
КонецПроцедуры

&НаСервере
Процедура ОтправитьПисьмо(Знач ПараметрыСохранения) Экспорт	
	ОбщийМодульСервисСервер.ОправитьПоEMAILКонтрагентуНаСервере(ПараметрыСохранения[1], ПараметрыСохранения[0], ОбщийМодульПовтор.ПолучитьТекстНаЯзыке("Отчет Руководителю") + ПараметрыСохранения[2], ПараметрыСохранения[3]);	  	
КонецПроцедуры

&НаСервере
Процедура Резервировать(Знач ПараметрыРезервирования) Экспорт	
	
	АдресКаталогБазыДанных = СтрЗаменить(ПараметрыРезервирования[0], """", "");
	
	ИмяФайла 		= формат(ПараметрыРезервирования[1], "ДФ=ггММдд-ЧЧммсс");
	КаталогРезерва 	= ПараметрыРезервирования[2] + "\" + ИмяФайла;
	файлыБазыДанных = НайтиФайлы(АдресКаталогБазыДанных, "*.*");
	
	СоздатьКаталог(КаталогРезерва);
	
	для каждого файлБазыДанных из файлыБазыДанных Цикл
		попытка
			КопироватьФайл(файлБазыДанных.ПолноеИмя, КаталогРезерва + "\" + файлБазыДанных.имя);
		исключение
		конецпопытки;					             	
	КонецЦикла;
	
	Если ПараметрыРезервирования[3] = Перечисления.ТипыЗадач.РезервированиеКаталогаСБазойДанныхВАрхив Тогда
		
		АдресФайла = ПараметрыРезервирования[2] + "\" + ИмяФайла + ".ZIp";
		архив = новый ЗаписьZipФайла(АдресФайла, , ОбщийМодульПовтор.ПолучитьТекстНаЯзыке("Автоматический архив с базой данных"), МетодСжатияZIP.Сжатие, УровеньСжатияZIP.Максимальный);
		архив.Добавить(КаталогРезерва + "\*.*", РежимСохраненияПутейZIP.СохранятьПолныеПути, РежимОбработкиПодкаталоговZIP.ОбрабатыватьРекурсивно);
		архив.Записать();		
		
		УдалитьФайлы(КаталогРезерва);
		
	КонецЕсли;
	
КонецПроцедуры

&НаСервере
Процедура ВыполнитьЗадачку(Знач напоминание) Экспорт
	
	Дата = ТекущаяДата();
	
	Для Каждого ПодЗадача Из напоминание.ВыполняемыеЗадачи Цикл
		
		типЗадачи = ПодЗадача.типЗадачи;
		
		СформироватьОтчетИОтправитьПоEmail 	  = типЗадачи = Перечисления.ТипыЗадач.СформироватьОтчетИОтправитьПоEmail;
		СформироватьОтчетИСохранитьВФайлExcel = типЗадачи = Перечисления.ТипыЗадач.СформироватьОтчетИСохранитьВФайлExcel;
		резервирование						  = типЗадачи = Перечисления.ТипыЗадач.РезервированиеКаталогаСБазойДанных ИЛи типЗадачи = Перечисления.ТипыЗадач.РезервированиеКаталогаСБазойДанныхВАрхив;
		
		Попытка 
			Если типЗадачи = Перечисления.ТипыЗадач.ВыполнитьПрограммныйКод Тогда
				
				ПараметрыЗадания = Новый Массив;
				ПараметрыЗадания.Добавить(ПодЗадача.КодИмяОтчета);
				ВыполнитьКод(ПараметрыЗадания);
				
				//ФоновыеЗадания.Выполнить("ОбщийМодульСерверПривилегия.ВыПолнитьКод", ПараметрыЗадания, "ВК" + Напоминание.Код, ОбщийМодульПовтор.ПолучитьТекстНаЯзыке("Выполнить код") + " " + Напоминание.Код);
				ОбщийМодульСервер.ДобавитьСобытиеЖурналаНаСервере(ОбщийМодульПовтор.ПолучитьТекстНаЯзыке("Выполнен код задачи") + " " + Напоминание.Наименование, 2, напоминание);
				
			ИначеЕсли СформироватьОтчетИОтправитьПоEmail
				или СформироватьОтчетИСохранитьВФайлExcel Тогда
				
				СтруктураУсловий = Новый Структура;
				СтруктураУсловий.Вставить("ДатаНачала", НачалоДня(НачалоДня(Дата) - 3600));
				СтруктураУсловий.Вставить("ДатаОкончания", КонецДня(Дата));
				СтруктураУсловий.Вставить("ОтборПоСкладу", Неопределено);
				
				ТабДок 		= Новый ТабличныйДокумент;
				ТабДок.КлючПараметровПечати = "Отчет_Руководителю";
				СтруктураОтчета = ОбщийМодульСервер.СформироватьОтчетРуководителюНаСервере(СтруктураУсловий);
				
				ОбщийМодульСервер.ПечатьНаСервереОтчетаРуководителю(СтруктураОтчета, ТабДок, СформироватьОтчетИОтправитьПоEmail);
				
				Если СформироватьОтчетИСохранитьВФайлExcel Тогда
					
					ПараметрыЗадания = Новый Массив;
					ПараметрыЗадания.Добавить(ТабДок);
					ПараметрыЗадания.Добавить(ПодЗадача.Адрес);
					ПараметрыЗадания.Добавить(ПодЗадача.КодИмяОтчета);
					
					СохранитьВФайл(ПараметрыЗадания);
					
					//ФоновыеЗадания.Выполнить("ОбщийМодульСерверПривилегия.СохранитьВФайл", ПараметрыЗадания, "СФ" + Напоминание.Код, ОбщийМодульПовтор.ПолучитьТекстНаЯзыке("Сохранить в файл") + " " + Напоминание.Код);
					ОбщийМодульСервер.ДобавитьСобытиеЖурналаНаСервере(ОбщийМодульПовтор.ПолучитьТекстНаЯзыке("Записан отчет руководителю в файл") + " " + ПодЗадача.Адрес + ОбщийМодульПовтор.ПолучитьТекстНаЯзыке(" задачи") + " " + Напоминание.Наименование, 2, напоминание);
					
				Иначе
					ТекстСопровождения = ОбщийМодульПовтор.ПолучитьТекстНаЯзыке("Подготовлен и отправлен автоматически");
					
					ПараметрыЗадания = Новый Массив;
					ПараметрыЗадания.Добавить(ТабДок);
					ПараметрыЗадания.Добавить(ТекстСопровождения);
					ПараметрыЗадания.Добавить(ПодЗадача.КодИмяОтчета);
					ПараметрыЗадания.Добавить(ПодЗадача.Адрес);
					
					ОтправитьПисьмо(ПараметрыЗадания);
					//ФоновыеЗадания.Выполнить("ОбщийМодульСерверПривилегия.ОтправитьПисьмо", ПараметрыЗадания, "ОП" + Напоминание.Код, ОбщийМодульПовтор.ПолучитьТекстНаЯзыке("Отправить письмо") + " " + Напоминание.Код);
					
					ОбщийМодульСервер.ДобавитьСобытиеЖурналаНаСервере(ОбщийМодульПовтор.ПолучитьТекстНаЯзыке("Отправлен отчет руководителю по email задачи") + " " + Напоминание.Наименование, 2, напоминание);
					
				КонецЕсли;			
				
			ИначеЕсли резервирование Тогда
				
				АдресКаталогБазыДанных = ПолучитьПредставлениеИнформационнойБазы();
				
				если не АдресКаталогБазыДанных = Неопределено тогда
					
					ПараметрыЗадания = Новый Массив;
					ПараметрыЗадания.Добавить(АдресКаталогБазыДанных);
					ПараметрыЗадания.Добавить(Дата);
					ПараметрыЗадания.Добавить(Подзадача.Адрес);
					ПараметрыЗадания.Добавить(типЗадачи);
					Резервировать(ПараметрыЗадания);
					
					//ФоновыеЗадания.Выполнить("ОбщийМодульСерверПривилегия.Резервировать", ПараметрыЗадания, "РЗ" + Напоминание.Код, ОбщийМодульПовтор.ПолучитьТекстНаЯзыке("Резервировать") + " " + Напоминание.Код);
					ОбщийМодульСервер.ДобавитьСобытиеЖурналаНаСервере(ОбщийМодульПовтор.ПолучитьТекстНаЯзыке("Зарезерварован каталог базы данных. Задачи") + " " + Напоминание.Наименование, 2, напоминание);
					
				КонецЕсли;    				
			КонецЕсли;
			
		Исключение 	
			
			ОписаниеОшибки = ОписаниеОшибки();
			если ОбщийМодульПовторВТеченииСервера.ВыводитьСообщенияМожно() тогда
				ОбщийМодульСервисСервер.ДобавитьСообщениеПользователю(ОбщийМодульПовтор.ПолучитьТекстНаЯзыке("Ошибка при исполнении задачи") + " " + ОписаниеОшибки, , напоминание.ссылка);
				//Сообщение = Новый СообщениеПользователю;
				//Сообщение.Текст = ОбщийМодульПовтор.ПолучитьТекстНаЯзыке("Произошла ошибка:") + " " + ОписаниеОшибки;
				//Сообщение.Сообщить();                                               	
			КонецЕсли;
			
			ОбщийМодульСервер.ДобавитьСобытиеЖурналаНаСервере(ОбщийМодульПовтор.ПолучитьТекстНаЯзыке("Ошибка при исполнении задачи") + " " + Напоминание.Наименование + " - " + ОписаниеОшибки, 2);
			
			Прервать;
			
		КонецПопытки;  		
	КонецЦикла;
	
КонецПроцедуры

Функция   ПолучитьПредставлениеИнформационнойБазы() Экспорт
	
	СтрокаСоединенияСБД = СтрокаСоединенияИнформационнойБазы();
	ЭтоФайловаяИБ = Найти(Врег(СтрокаСоединенияСБД), "FILE=") = 1;
	
	Если ЭтоФайловаяИБ Тогда
		Возврат Сред(СтрокаСоединенияСБД, 6, СтрДлина(СтрокаСоединенияСБД) - 6);
	Иначе
		Возврат неопределено;
	КонецЕсли;
	
КонецФункции

Функция   ПроверитьНаличиеПропущенныхНапоминаний(ТолькоЗадачи = Ложь) Экспорт
	
	СтруктураНапоминаний = Новый Структура;
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ ЗаметкиИНапоминания.Наименование,
	|	ЗаметкиИНапоминания.ПовторятьКаждыеЧислоЧасов,
	|	ЗаметкиИНапоминания.Причина,
	|	ЗаметкиИНапоминания.ДатаПоследнегоНапоминания,
	|	ЗаметкиИНапоминания.Дата,
	|	ЗаметкиИНапоминания.ТипЗаметки,
	|	ЗаметкиИНапоминания.Ссылка,
	|	ЗаметкиИНапоминания.Получатель
	|ИЗ Справочник.ЗаметкиИНапоминания КАК ЗаметкиИНапоминания
	|ГДЕ ЗаметкиИНапоминания.ТипЗаметки = &ТипЗаметки
	|	И ЗаметкиИНапоминания.Актуально = ИСТИНА
	|	И ЗаметкиИНапоминания.Дата <= &Дата
	|	И (ЗаметкиИНапоминания.ДатаПоследнегоНапоминания = &ПустаяДата
	|			ИЛИ НЕ ЗаметкиИНапоминания.ПовторятьКаждыеЧислоЧасов = 0)
	|	И (ЗаметкиИНапоминания.Получатель = &ПустойПолучатель или ЗаметкиИНапоминания.Получатель = &ПользовательПоУмолчанию
	|	ИЛИ ЗаметкиИНапоминания.Получатель = &ТекущийПользователь)";
	
	ПустаяДата 	= '00010101000000';
	Дата 		= ТекущаяДата();
	Запрос.УстановитьПараметр("Дата", Дата);
	Запрос.УстановитьПараметр("ПользовательПоУмолчанию", ПредопределенноеЗначение("Справочник.Пользователи.ПользовательПоУмолчанию"));
	Запрос.УстановитьПараметр("ПустойПолучатель", ПредопределенноеЗначение("Справочник.Пользователи.ПустаяСсылка"));
	Запрос.УстановитьПараметр("ТекущийПользователь", ОбщийМодульПовтор.ПолучитьПараметрСеанса("ТекущийПользователь"));
	Запрос.УстановитьПараметр("ПустаяДата", ПустаяДата);
	Запрос.УстановитьПараметр("ТипЗаметки", ?(ТолькоЗадачи, Перечисления.ТипыЗаметок.Задача, Перечисления.ТипыЗаметок.Напоминание));
	
	РезультатЗапроса = Запрос.Выполнить();
	РезультатЗапросаПустой = РезультатЗапроса.Пустой();
	
	СтруктураНапоминаний.Вставить("Есть", Ложь);
	
	Если НЕ РезультатЗапросаПустой Тогда
		ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
		
		СтруктураНапоминаний.Вставить("МассивНапоминаний", Новый Массив);
		
		Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
			
			если ВыборкаДетальныеЗаписи.ДатаПоследнегоНапоминания = ПустаяДата Тогда 
				СтруктураНапоминаний.МассивНапоминаний.Добавить(ВыборкаДетальныеЗаписи.ссылка);
				СтруктураНапоминаний.Есть = Истина;
				
			иначе
				СледующийПериод = ВыборкаДетальныеЗаписи.ДатаПоследнегоНапоминания + ВыборкаДетальныеЗаписи.ПовторятьКаждыеЧислоЧасов * 3600;
				
				если СледующийПериод < Дата тогда
					СтруктураНапоминаний.МассивНапоминаний.Добавить(ВыборкаДетальныеЗаписи.ссылка);	
					СтруктураНапоминаний.Есть = Истина;
				КонецЕсли;
			КонецЕсли;
		КонецЦикла;
	КонецЕсли;	
	
	Возврат СтруктураНапоминаний;
	
КонецФункции 

Функция   ЗаписатьВыполнениеНапоминания(Знач напоминание) Экспорт
	
	напоминаниеОбъект = напоминание.ПолучитьОбъект();
	напоминаниеОбъект.ДатаПоследнегоНапоминания = ТекущаяДата();
	напоминаниеОбъект.Записать();
	
	Возврат напоминаниеОбъект.ссылка
	
КонецФункции

Процедура ВыполнитьЗадачи() Экспорт
	
	Если ОбщийМодульПовтор.получитьЗначениеНастройкиИлиКонстанты("ИспользоватьМеханизмЗаметокИНапоминаний") Тогда
		
		МассивНапоминаний 	 = Новый Массив;
		СтруктураНапоминаний = ОбщийМодульСерверПривилегия.ПроверитьНаличиеПропущенныхНапоминаний(Истина);
		
		Если СтруктураНапоминаний.Есть Тогда			
			
			НаименованиеФЗ = ОбщийМодульПовтор.ПолучитьТекстНаЯзыке("Задача на фоне") + " ";
			Для каждого напоминание из СтруктураНапоминаний.МассивНапоминаний Цикл				
				
				напоминание = ОбщийМодульСерверПривилегия.ЗаписатьВыполнениеНапоминания(напоминание);	
				ОбщийМодульСерверПривилегия.ВыполнитьЗадачку(напоминание);	
				
			КонецЦикла;
		КонецЕсли; 		
	КонецЕсли;	
	
КонецПроцедуры

&НаСервере
Функция   ОпределитьПользователя() Экспорт
	
	НаименованиеПользователя = Сокрлп(ПользователиИнформационнойБазы.ТекущийПользователь());
	Если НаименованиеПользователя = "" Тогда
		
		ОпределенныйПользователь = ОбщийМодульПовтор.ЗначениеПредопределенного("Справочники.Пользователи.ПользовательПоУмолчанию");
	иначе
		
		ОпределенныйПользователь = Справочники.Пользователи.НайтиПоНаименованию(НаименованиеПользователя);
		Если НЕ ЗначениеЗаполнено(ОпределенныйПользователь) Тогда
			ОпределенныйПользовательОбъект 	= Справочники.Пользователи.СоздатьЭлемент();
			ОпределенныйПользовательОбъект.Наименование = НаименованиеПользователя;
			ОпределенныйПользовательОбъект.Записать();
			ОпределенныйПользователь 		= ОпределенныйПользовательОбъект.Ссылка;
		КонецЕсли;
		
	КонецЕсли;
	
	Возврат ОпределенныйПользователь;
	
КонецФункции //ОпределитьПользователя

Процедура ПерепровестиПриходныеИРасходныеДокументыНачинаяСДатыДляВосстановленияПоказателейВаловойПрибыли() Экспорт
	
	ДатаАктуальностиПоказателейВаловойПрибыли = Константы.ДатаАктуальностиПоказателейВаловойПрибыли.Получить();
	
	если ЗначениеЗаполнено(ДатаАктуальностиПоказателейВаловойПрибыли) тогда
		
		НеВыводитьСообщений = ПараметрыСеанса.НеВыводитьСообщений;
		ПараметрыСеанса.НеВыводитьСообщений = Истина;
		
		Попытка 
			УстановитьМонопольныйРежим(Истина);
		Исключение 	
		КонецПопытки;
		
		Запрос = Новый Запрос;
		Запрос.Текст = "ВЫБРАТЬ РАЗЛИЧНЫЕ Товары.Регистратор КАК Ссылка,
		|	Товары.Период КАК Дата
		|ИЗ РегистрНакопления.Товары КАК Товары
		|ГДЕ Товары.Период > &ДатаАктуальностиПоказателейВаловойПрибыли
		|УПОРЯДОЧИТЬ ПО Дата";
		
		Запрос.УстановитьПараметр("ДатаАктуальностиПоказателейВаловойПрибыли", ДатаАктуальностиПоказателейВаловойПрибыли);
		
		РезультатЗапроса = Запрос.Выполнить();
		если не РезультатЗапроса.Пустой() тогда
			ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
			
			Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
				Документ = ВыборкаДетальныеЗаписи.Ссылка.ПолучитьОбъект();
				попытка
					Документ.Записать(РежимЗаписиДокумента.Проведение);
				Исключение 	
					ОбщийМодульСервисСервер.ДобавитьСообщениеПользователю(ОбщийМодульПовтор.ПолучитьТекстНаЯзыке("Ошибка проведения документа:") + " " + Документ, , Документ.Ссылка);
					//Сообщение = Новый СообщениеПользователю;
					//Сообщение.Текст = ОбщийМодульПовтор.ПолучитьТекстНаЯзыке("Ошибка проведения документа:") + " " + Документ;//ОписаниеОшибки();
					//Сообщение.Сообщить();
					
				КонецПопытки;
			КонецЦикла;
			
			Константы.ДатаАктуальностиПоказателейВаловойПрибыли.Установить('00010101000000') ;
		КонецЕсли;	
		
		Попытка 
			УстановитьМонопольныйРежим(Ложь);
		Исключение 	
		КонецПопытки;
		
		ПараметрыСеанса.НеВыводитьСообщений = НеВыводитьСообщений;
		
	КонецЕсли;
	
КонецПроцедуры	

Функция   НетБольшеПодключенийКБазеДанных() Экспорт
	Возврат ПолучитьСоединенияИнформационнойБазы().Количество() = 1;
КонецФункции 

&НаСервере
Процедура ОбновитьНаименованияПравПользователей(Знач ВНезависимосиОтЯзыка)
	
	Если ВНезависимосиОтЯзыка
		ИЛИ Константы.ПоддерживатьИныеЯзыкиКромеРусского.Получить() Тогда
		
		Пользователи = Справочники.Пользователи.Выбрать();
		Пока Пользователи.Следующий() Цикл
			
			ПользовательОбъект = Пользователи.Ссылка.ПолучитьОбъект();
			ЕстьИзменения = Ложь;
			
			Для Каждого СтрокаДоступа Из ПользовательОбъект.Доступ Цикл
				ОбъектДоступа = ОбщийМодульПовтор.ПолучитьТекстНаЯзыке(СтрокаДоступа.ОбъектДоступа);
				Если НЕ СтрокаДоступа.ОбъектДоступа = ОбъектДоступа Тогда
					СтрокаДоступа.ОбъектДоступа = ОбъектДоступа;
					ЕстьИзменения = Истина;
				КонецЕсли;			
			КонецЦикла;
			
			Если ЕстьИзменения Тогда
				ПользовательОбъект.Записать();
			КонецЕсли;
			
		КонецЦикла;	
	КонецЕсли;
	
КонецПроцедуры
