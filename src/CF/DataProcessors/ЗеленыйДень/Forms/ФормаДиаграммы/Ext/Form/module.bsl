//Sza080316
Процедура ПередОткрытием(Отказ, СтандартнаяОбработка) //подготовка диаграммы
	Попытка Состояние("Вывод диаграммы..");
		РезультатыВирт.Сортировать("Наименование Возр, ПериодАнализа Возр");
		ТаблицаДиаграмме=Новый ТаблицаЗначений;
		ТаблицаДиаграмме.Колонки.Добавить("Наименование");
		МассивИмен=Новый Массив;
		МассивДат=Новый Массив;
		Счетчик=0;
		Для каждого СтрокаРезультата Из РезультатыВирт Цикл	//оригинальный массив массива дат (измерение диаграммы)
			Если МассивДат.Найти(СтрокаРезультата.ПериодАнализа)=Неопределено Тогда
				МассивДат.Добавить(СтрокаРезультата.ПериодАнализа);
				ТаблицаДиаграмме.Колонки.Добавить("Дата"+СокрЛП(Счетчик),,Формат(СтрокаРезультата.ПериодАнализа,"ДФ=dd.MM.yyyy"));
				Счетчик=Счетчик+1;
			КонецЕсли;	
		КонецЦикла;
		Для каждого СтрокаРезультата Из РезультатыВирт Цикл	//сбор данных по измерению диаграммы наименование
			СтрокаТаблицыДиаграммыНаименование=СокрЛП(СтрокаРезультата.Наименование);
			СтрокаТаблицыДиаграммыНаименование=СтрЗаменить(СтрокаТаблицыДиаграммыНаименование,"Число док. ","");
			СтрокаТаблицыДиаграммыНаименование=СтрЗаменить(СтрокаТаблицыДиаграммыНаименование,"Число элт. ","");
			СтрокаТаблицыДиаграммыНаименование=СтрЗаменить(СтрокаТаблицыДиаграммыНаименование,"Движений по ","");
			СтрокаТаблицыДиаграммыНаименование=СтрЗаменить(СтрокаТаблицыДиаграммыНаименование,"Записей в ","");
			Если МассивИмен.Найти(СтрокаТаблицыДиаграммыНаименование)=Неопределено Тогда
				СтрокаТаблицыДиаграммы=ТаблицаДиаграмме.Добавить();
				МассивИмен.Добавить(СтрокаТаблицыДиаграммыНаименование);
				СтрокаТаблицыДиаграммы.Наименование=СтрокаТаблицыДиаграммыНаименование;
			КонецЕсли;	
			НомерЭлементаМассиваДат=МассивДат.Найти(СтрокаРезультата.ПериодАнализа);
			Если НЕ НомерЭлементаМассиваДат=Неопределено Тогда
				СтрокаТаблицыДиаграммы["Дата"+СокрЛП(НомерЭлементаМассиваДат)]=СтрокаРезультата.ПроцентИсполнения;
			Иначе СтрокаТаблицыДиаграммы.Дата0=СтрокаРезультата.ПроцентИсполнения;
			КонецЕсли;	
		КонецЦикла;
		ЭтаФорма.ЭлементыФормы.Диагр.ИсточникДанных=ТаблицаДиаграмме;
	Исключение 
		Отказ=Истина;
		ПоказатьПредупреждение(Неопределено, "При выводе диаграммы произошла ошибка программы: "+ОписаниеОшибки(),0,"Ошибка!");		
	КонецПопытки;
КонецПроцедуры
