<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"><html><head><meta content="text/html; charset=utf-8" http-equiv="Content-Type"></meta><link rel="stylesheet" type="text/css" href="v8help://service_book/service_style"></link><meta name="GENERATOR" content="MSHTML 11.00.9600.17126"></meta></head><body>
<h1>Настройка файла конфигурации технологического журнала (logcfg.xml)</h1>
<dl><dt>Данная обработка предназначена для редактирования файла конфигурации технологического журнала (<strong>logcfg.xml</strong>).</dt></dl><p class="Important">Возможности данной обработки не позволяют полностью использовать возможности, предоставляемые форматом этого файла в части настроек событий, регистрируемых в технологическом журналое, однако, предоставляемых возможностей достаточно для быстрого создания конфигурационных файлов, закрывающих значительную часть потребностей.</p>
<p>При открытии обработка выполняет попытку открыть существующий файл конфигурации технологического журнала. Поиск файла выполняется по следующим путям:</p>
<ul><li>Каталог <strong>bin\conf</strong> запущенной версии 1С:Предприятия 8. Если файл обнаружен - он открывается обработкой и дальнейший поиск пркращается. 
</li><li>Если файл не обнаружен и в каталоге <strong>bin\conf</strong> расположен файл <strong>conf.cfg</strong>, то производится попытка найти файл в каталоге, указанного в этом файле. Если файл найден - он открывается обработкой.</li></ul><p>С помощью данной обработки можно указывать параметры формирования дампа, контроля утечек памяти и параметры технологического журнала.</p>
<p>На закладке <strong class="ControlElement">Настройки технологического журнала</strong> можно завать параметры формирования технологического журнала.</p>
<p>На закладке <strong class="ControlElement">Настройки дампа и отслеживания утечек памяти</strong> имеется возможность задавать параметры:</p>
<ul><li>Создания дампов памяти; 
</li><li>Фиксации утечек памяти на сервере; 
</li><li>Фиксации утечек памяти в конфигурации.</li></ul><p>На закладке <strong>Технологический журнал по умолчанию и системные события</strong> выполняется настройка параметров формирования технологического журнала по умолчанию.</p>
<p>Также имеется возможность формировать шаблоны файлов конфигурации.</p>
<p>Для этого необходимо задать необходимые параметры файла конфигурации и выполнить команду <strong>Еще - Сохранить как шаблон...</strong> Файл конфигурации будет сохранен в каталог общих конфигурационных файлов с именем <strong>config*.lct </strong>(вместо символа * будет подставлен порядковый номер файла шаблона).</p>
<h2>Работа с редактором параметров технологического журнала</h2>
<p>Рассмотрим приемы работы с редактором параметров технологического журнала.</p>
<h3>Настройка параметров редактора технологического журнала</h3>
<p>Над редактором располагается группа параметров <strong>Настройки</strong>. В этой группе задаются необходимость ведения технологического журнала, место его расположения и период хранения, а также параметры, которые позволяют сделать процесс редактирования более удобным. Группу можно свернуть, после того, как выполнены все настройки, чтобы она занимала меньше места на экране.</p>
<p>Флажок <strong>Формировать технологический журнал</strong> управляет необходимостью создания технологического журнала системой "1С:Предприятия". </p>
<p><strong>Местоположение технологического журнала</strong> и <strong>Период хранения истории, часы</strong> определяют где и как долго будет храниться технологический журнал.</p>
<p>В правой части группы настроек располагаются вспомогательные элементы управления, которые позволяют сделать процесс редактирования более удобным. Группа переключателей (<strong class="ControlElement">Все свойства</strong>, <strong class="ControlElement">Только выбранные свойства</strong> и <strong class="ControlElement">Все свойства выбранных событий</strong>) определяет, какие события будут отображаться в окне редактора:</p>
<ul><li>
<div><strong>Все свойства выбранных событий</strong> - это динамический режим. При этом отображаются только те свойства, которые доступны для выбранных событий (отмечена самая первая колонка). Добавляя или убирая события - варьируется состав отображаемых свойств. При отображении игнорируется тот факт, что для неотмеченной колонки может быть задано какое-либо свойство.</div>
</li><li>
<div>
<div><strong>Только выбранные свойства</strong> - в этом случае будут отображаться только те свойства, для которых установлена отметка хотя-бы в одном событии технологического журнала. Режим не является динамическим.</div></div>
</li><li>
<div>
<div><strong>Все свойства</strong> - в этом случае будут отображаться все свойства всех событий технологического журнала. Режим не является динамическим.</div></div></li></ul><p>Если нужно отобразить только те события, которые каким-либо образом выбраны (отметкой в любой колонке конкретного события), то сделать это можно с помощью флажка <strong class="ControlElement">Только отмеченные события</strong>.</p>
<p>С помощью переключателей <strong>Отображать описания</strong> и <strong>Отображать имена</strong> можно управлять способом отображения свойств и событий в редакторе.</p>
<dl><dt>
<div>Также, в нижней части формы отображаемтся описание текущего события (группа <strong>Текущее событие</strong>) и текущего свойства (группа <strong>Текущее свойство</strong>). Идентификатор текущего события или свойства отображается в скобках после соотвествующего текста. Например, для события "SQL, Microsoft SQL Server" заголовок группы будет иметь вид <strong>Текущее событие (dbmssql)</strong>. Если эта вспомогательная информация не нужна, то ее можно убрать, свернув группу <strong>Дополнительная информация</strong>.</div></dt></dl><h3>Общие правила редактирования</h3>
<p>Редактор параметров представляет собой матрицу, в строках которой представлены события, которые могут попадать в технологический журнал, а в колонках - свойства этих событий.</p>
<p>Ячейки, которые имеют белый фон и обведены рамкой, выполняют какие-либо действия, если по ним щелкнуть мышью. Щелчок мышью по ячейки вызывает отметку - появление символа "V". Повторный щелчок снимает отметку.</p>
<p>Если выполняется отметка ячейки в колонке <strong class="ControlElement">Все события</strong> или любой колонки правее этой колонки, то одновременно выполняется отметка также самой первой ячейки у текущего события (включение в технологический журнал самого события). Снятие отметки не имеет таких особенностей.</p>
<p>Отметка свойства для всех событий (для которых определено данное свойство) выполняется с помощью команды контекстного меню <strong class="ControlElement">Включить для всех событий</strong>. Для того, чтобы снять отметки следует воспользоваться командой контекстного меню <strong class="ControlElement">Выключить для всех событий</strong>, стоя в любой строке колонки с выбранным свойством.</p>
<p>Если необходимо назначить условие на событие, это следует делать с помощью команды контекстного меню <strong class="ControlElement">Условие на событие...</strong>, находясь в любой колонке выбранного события. Если условия будут заданы, то отметка приобрете вид "<strong>V</strong>" (отметка полужирным шрифтом). Для удаления условий на событие следует либо удалить все события в окне редактора условий, или воспользоваться командой контекстного меню <strong class="ControlElement">Очистить фильтр для события</strong>. При этом отметка сохранится, но потеряет полужирное оформление.</p>
<p>Если необходимо назначить условие на свойство события, это следует делать с помощью команды контекстного меню <strong class="ControlElement">Условие на свойство...</strong>, находясь в ячейки, которую можно редактировать (белый фон и рамка). Если условия будут заданы, то отметка приобрете вид "<strong>V</strong>" (отметка полужирным шрифтом). Для удаления условий на событие следует либо удалить все события в окне редактора условий, или воспользоваться командой контекстного меню <strong class="ControlElement">Очистить фильтр для свойства</strong>. При этом отметка сохранится, но потеряет полужирное оформление.</p>
<p>Если необходимо очистить все настройки свойств и событий технологического журнала, следует выбрать команду контекстного меню редакт ора <strong>Очистить параметры технологического журнала</strong>. В случае утвердительного ответа журнал будет настроен на регистрацию всех свойств для всех событий. Никакие другие параметры технологического журнала (время жизни и путь в каталогу технологического журнала не будут изменены).</p>
<h3>Шаблоны и их использование</h3>
<p>Для упрощения создания файлов конфигурации в некоторых типовых случаях, редактор файла конфигурации технологического журнала содержит несколько шаблонов (заранее подготовленных файлов конфигурации), которые позволяют быстро выполнить настройки файла конфигурации. Для использования шаблона следует выбрать команду <strong>Шаблон...</strong> и в открывшемся окне выбрать нужный шаблон.</p>
<p>Кроме того, существует возможность самостоятельно создавать шаблоны файла конфигурации. Для этого следует задать необходимые параметры на обоих закладках (<font color="#000040"><strong>Настройки технологического журнала</strong> и <strong>Настройки дампа и отслеживания утечек памяти</strong></font>) и выбрать команду <strong>Все действия - Сохранить как шаблон...</strong> После задания параметров шаблона, происходит сохранение файла шаблона в каталог конфигурационных файлов системы.</p>
<p>Затем эти шаблоны также будут доступны в окне выбора шаблона при выборе команды <strong>Шаблон...</strong></p>
<dl><dt>
<h3>Типовые операции в редакторе параметров технологического журнала</h3></dt></dl><p>Если необходимо включить в технологический журнал все события и все свойства событий, следует установить отметку для события "Все события" и свойства "Все свойства". В файл <strong>logcfg.xml</strong> попадает следующий текст:</p><pre class="SyntaxDescription">&lt;event&gt;<br> &lt;ne property="name" value=""/&gt;<br>&lt;/event&gt;<br>&lt;property name="all"/&gt;<br></pre>
<p>Если необходимо, чтобы в файл всегда попадала конструкция <strong>&lt;property name="all"/&gt;</strong>, необходимо чтобы было установлено свойство "Все свойства" для события "Все события" (не включая само событие).</p>
<p>Если необходимо включить в технологический журнал все события какого-либо свойства, для этого необходимо отметить самую первую колонку, расположенную перед выбранным свойством). Например, если отметка стоит перед свойством "Microsoft SQL Server", то в файл <strong>logcfg.xml</strong> попадет следующая текст:</p><pre class="SyntaxDescription">&lt;event&gt;<br> &lt;eq property="name" value="dbmssql"/&gt;<br>&lt;/event&gt;<br></pre>
<p dir="ltr">Если необходимо включить в технологически журнал все свойства выбранного события, то следует отметить свойство "Все свойства" у необходимого события (при этом событие будет отмечено автоматически, а все доступные свойства данного события будут отмечены особым цветом фона). Например, если колонка "Все свойства" отмечена у свойства "SQL, Microsoft SQL Server", то в файл <strong>logcfg.xml</strong> попадет следующий текст:</p><pre class="SyntaxDescription" dir="ltr">&lt;event&gt;<br> &lt;eq property="name" value="dbmssql"/&gt;<br>&lt;/event&gt;<br>&lt;property name="all"&gt;<br> &lt;event&gt;<br>  &lt;eq property="name" value="dbmssql"/&gt;<br> &lt;/event&gt;<br>&lt;/property&gt;<br></pre>
<p>Если необходимо, чтобы событие попадало в технологический журнал только в том случае, если вполняется некоторое условие, то следует вызвать контекстное меню в любой колонке события и выбрать команду <strong>Условия на событие...</strong> В открывшемся окне можно задавать необходимые условия (для задания условий доступны только свойства, присутствующие у выбранного события). В файл <strong>logcfg.xml</strong> попадет текст, подобный следующему (событие <strong>dbmssql</strong> попадет в технологический журнал в случае, если свойство <strong>duration</strong> больше, чем <strong>100 000</strong>):</p><pre class="SyntaxDescription" dir="ltr">&lt;event&gt;<br> &lt;eq property="name" value="dbmssql"/&gt;<br> &lt;gt property="duration" value="15000"/&gt;<br>&lt;/event&gt;<br></pre>
<p dir="ltr">Если необходимо, чтобы свойство попало в технологический журнал для какого-либо события только в случае выполнения некоторого условия, следует в строке необходимого события встать в колонку нужного свойства и в контекстном меню выбрать команду <strong>Условия на свойство...</strong> (в том случае, если данное свойство доступно для выбранного события). В открывшемся окне можно задавать условия на свойство. В файл <strong>logcfg.xml</strong> попадет текст, подобный следующему (свойство <strong>sql</strong> события <strong>dbmssql</strong> попадет в технологический журнла только тогда, когда свойство <strong>duration</strong> события <strong>dbmssql</strong> больше <strong>150 000</strong>):</p><pre class="SyntaxDescription">&lt;property name="sql"&gt;<br> &lt;event&gt;<br>  &lt;eq property="name" value="dbmssql"/&gt;<br>  &lt;gt property="duration" value="15000"/&gt;<br> &lt;/event&gt;<br>&lt;/property&gt;</pre>
<p class="Usual">Если необходимо включить в технологический журнал конкретное свойство для всех событий, то следует в контекстном меню выбрать команду <strong>Включить для всех событий</strong>. В файл <strong>logcfg.xml</strong> попадет текст, подобный следующему:</p><pre class="SyntaxDescription">&lt;property name="dbpid"&gt;<br> &lt;event&gt;<br>  &lt;ne property="name" value=""/&gt;<br> &lt;/event&gt;<br> &lt;event&gt;<br>  &lt;eq property="name" value="db2"/&gt;<br> &lt;/event&gt;<br> &lt;event&gt;<br>  &lt;eq property="name" value="dbmssql"/&gt;<br> &lt;/event&gt;<br> &lt;event&gt;<br>  &lt;eq property="name" value="dboracle"/&gt;<br> &lt;/event&gt;<br> &lt;event&gt;<br>  &lt;eq property="name" value="dbpostgrs"/&gt;<br> &lt;/event&gt;<br>&lt;/property&gt;</pre>
<h2>Работа с настройками дампа, отслеживанием утечек памяти и сохранением планов запросов</h2>
<h3>Настройки дампа</h3>
<p>Для того, чтобы система 1С:Предприятие создавал дамп памяти при наступлении ошибки, приводящей к аварийному заверщшению работы системы, необходимо включить флажок <strong>Создавать дамп при аварийном завершении</strong>, выбрать местоположение файла с дампом и его тип. В большинстве случаев достаточно оставить тип дампа, установленный по умолчанию (или использовать команду <strong>Оптимальный размер дампа</strong> контекстного меню поля редактирования типа дампа).</p>
<h3>Настройки сохранения планов запросов</h3>
<p>За сохранение планов запросов в технологическом журнале отвечает флажок <strong>Отслеживать планы запросов (&lt;planSQL&gt;)</strong> и свойство <strong>planSQLText</strong> событий исполнения операторов SQL различных СУБД. Установка первого флажка включает саму возможность генерации планов запросов, а включение или выключение свойства управляет доступностью информации о планах запросов в соответствующих событиях. Если включается сохранение планов запросов, то рекомендуется также включить запись свойства <strong>SQL</strong> для событий исполнения операторов SQL различных СУБД.</p><pre class="SyntaxDescription"> &lt;plansql/&gt;<br> &lt;log location="C:\v82\logs\" history="48"&gt;<br>  &lt;event&gt;<br>   &lt;eq property="name" value="dbmssql"/&gt;<br>  &lt;/event&gt;<br>  &lt;property name="plansqltext"&gt;<br>   &lt;event&gt;<br>    &lt;eq property="name" value="dbmssql"/&gt;<br>   &lt;/event&gt;<br>  &lt;/property&gt;<br>  &lt;property name="sql"&gt;<br>   &lt;event&gt;<br>    &lt;eq property="name" value="dbmssql"/&gt;<br>   &lt;/event&gt;<br>  &lt;/property&gt;<br> &lt;/log&gt;</pre>
<p>В данном примере для события исполнения операторов СУБД сервера MSSQL (событие <strong>dbmssql</strong>) включена фиксация текстов запросов на языке SQL (свойство <strong>sql</strong>) и планов исполнения запросов (свойство <strong>plansqltext</strong>). Также включен сбор планов исполнения запросов (элемент <strong>plansql</strong>).</p>
<p class="Important">Получение планов запросов замедляет выполнение запросов к СУБД. Для некоторых СУБД замедление может быть существенным.</p>
<h3>Настройки утечек памяти</h3>
<p class="Usual">За контроль утечек памяти отвечает две настройки:</p>
<ul><li>
<div><strong>Отслеживать использовании памяти сервером</strong>. При этом следует либо включить вывод в технологический журнал всех событий, либо отдельно включить событие <strong>mem</strong> (<strong>Утечка памяти сервера</strong>).</div>
</li><li>
<div><strong>Отслеживать утечки памяти в коде конфигурации</strong>. В этом случае необходимо указать, в каких областях конфигурации необходимо контроллировать утечки памяти. Это можно выполнить с помощью флажков <strong>Контрольная точка начала/окончания исполнения кода на клиенте</strong>, <strong>Контрольная точка начала/окончания исполнения кода на сервере</strong>, а также списки для ввода информации о контроллируемых модулях. При этом следует либо включить вывод в технологический журнал всех событий, либо отдельно включить событие <strong>leaks</strong> (<strong>Утечка памяти</strong>).</div></li></ul><h2>Настройка ведения технологического журнала по умолчанию</h2>
<p>Технологический журнал по умолчанию - это особый вид технологического журнала, предназначенный для записи событий, возникающих в критических ситуациях (с точки зрения системы «1С:Предприятие»). Для этого журнала создается фиксированный фильтр событий, который формирует платформа и который невозможно изменить.</p>
<p>Однако, имеется возможность настроить <strong>Местоположение системного технологического журнала</strong> и <strong>Период хранения истории, часы</strong>. Для установки параметров хранения технологического журнала по умолчанию в значения по умолчанию служит гиперссылка <strong>Установить настройки системного технологического журнала по умолчанию</strong>.</p>
<p>С помощью таблицы <strong>Системные события</strong> можно задать детализацию записываемых событий.</p></body></html>