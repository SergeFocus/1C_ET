#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда

// sza140915-0023
Процедура НаПечать(ДокументДляПечати, Ссылка) Экспорт
	
	ДокументДляПечати.ИмяПараметровПечати  = "Спецификация" + СокрЛП(ИмяКомпьютера());
	ДокументДляПечати.КлючПараметровПечати = ДокументДляПечати.ИмяПараметровПечати;
	
	ДокументДляПечати.Очистить();
	
	СсылкаНаОбъектПечати = Ссылка[0];
	
	РазрядМетаданных = ""; ИмяМетаданных = "";
	ПроизвольнаяПечатнаяФорма = ОбщийМодульТекстСервер.ОпределитьПроизвольнуюПечатнуюФорму(, , СсылкаНаОбъектПечати, РазрядМетаданных, ИмяМетаданных);
	
	Если ЗначениеЗаполнено(ПроизвольнаяПечатнаяФорма) Тогда
		ДокументДляПечати = ОбщийМодульТекстСервер.СформироватьДокументПоПроизвольнойФорме(ПроизвольнаяПечатнаяФорма, , ДокументДляПечати, СсылкаНаОбъектПечати, РазрядМетаданных, ИмяМетаданных);
		
	Иначе		
		Макет = Справочники.Спецификации.ПолучитьМакет("НаПечать");
		Макет.КодЯзыкаМакета = ОбщийМодульПовтор.ПолучитьТекущийЯзыкДокументов();
		
		Запрос = Новый Запрос;
		Запрос.Текст = "ВЫБРАТЬ Спецификации.ВерсияСпецификации,
		|	Спецификации.Дата,
		|	Спецификации.ДатаРедакции,
		|	Спецификации.ДатаСоздания,
		|	Спецификации.ДополнительныйКоэффициентКСебестоимости,
		|	Спецификации.Код,
		|	ВЫРАЗИТЬ(Спецификации.Комментарий КАК СТРОКА(1000)) КАК Комментарий,
		|	Спецификации.Наименование,
		|	Спецификации.НеАктуальна,
		|	Спецификации.ОбщееВремя,
		|	Спецификации.Ответственный,
		|	Спецификации.ДополнительныеРасходы.(
		|		НомерСтроки,
		|		Статья,
		|		Сумма,
		|		Валюта,
		|		НеРаспределятьНаСтоимость,
		|		ОСтроке ),
		|	Спецификации.ЗадействованныеСредства.(
		|		НомерСтроки,
		|		Средство,
		|		Коэффициент,
		|		ОСтроке ),
		|	Спецификации.Материалы.(
		|		НомерСтроки,
		|		Номенклатура,
		|		Спецификация,
		|		Количество,
		|		ОСтроке ),
		|	Спецификации.Работы.(
		|		НомерСтроки,
		|		Номенклатура,
		|		Количество,
		|		ВремяВыполнения,
		|		ОСтроке ),
		|	Спецификации.Товары.(
		|		НомерСтроки,
		|		Номенклатура,
		|		ЕдиницаИзмерения,
		|		Количество,
		|		ОСтроке )
		|ИЗ Справочник.Спецификации КАК Спецификации
		|ГДЕ Спецификации.Ссылка В (&Ссылка)";
		
		Запрос.Параметры.Вставить("Ссылка", Ссылка);
		Выборка = Запрос.Выполнить().Выбрать();
		
		ОбластьЗаголовок 					= Макет.ПолучитьОбласть("Заголовок");
		Шапка 								= Макет.ПолучитьОбласть("Шапка");
		ОбластьДополнительныеРасходыШапка 	= Макет.ПолучитьОбласть("ДополнительныеРасходыШапка");
		ОбластьДополнительныеРасходы 		= Макет.ПолучитьОбласть("ДополнительныеРасходы");
		ОбластьЗадействованныеСредстваШапка = Макет.ПолучитьОбласть("ЗадействованныеСредстваШапка");
		ОбластьЗадействованныеСредства 		= Макет.ПолучитьОбласть("ЗадействованныеСредства");
		ОбластьМатериалыШапка 				= Макет.ПолучитьОбласть("МатериалыШапка");
		ОбластьМатериалы 					= Макет.ПолучитьОбласть("Материалы");
		ОбластьРаботыШапка 					= Макет.ПолучитьОбласть("РаботыШапка");
		ОбластьРаботы 						= Макет.ПолучитьОбласть("Работы");
		ОбластьТоварыШапка 					= Макет.ПолучитьОбласть("ТоварыШапка");
		ОбластьТовары 						= Макет.ПолучитьОбласть("Товары");
		Подвал 								= Макет.ПолучитьОбласть("Подвал");
		
		ВставлятьРазделительСтраниц = ЛОЖЬ;
		Пока Выборка.Следующий() Цикл
			Если ВставлятьРазделительСтраниц Тогда
				ДокументДляПечати.ВывестиГоризонтальныйРазделительСтраниц();
			КонецЕсли;
			
			ОбщийМодульСервисСервер.ЗаменитьСвоиЗначенияПараметровПечати(ОбластьЗаголовок);
			ДокументДляПечати.Вывести(ОбластьЗаголовок);
			
			Шапка.Параметры.Заполнить(Выборка);
			ОбщийМодульСервисСервер.ЗаменитьСвоиЗначенияПараметровПечати(Шапка);
			ДокументДляПечати.Вывести(Шапка, Выборка.Уровень());
			
			ВыборкаДополнительныеРасходы = Выборка.ДополнительныеРасходы.Выбрать();
			Если НЕ ВыборкаДополнительныеРасходы.Количество() = 0 Тогда
				ОбщийМодульСервисСервер.ЗаменитьСвоиЗначенияПараметровПечати(ОбластьДополнительныеРасходыШапка);
				ДокументДляПечати.Вывести(ОбластьДополнительныеРасходыШапка);
				
				Пока ВыборкаДополнительныеРасходы.Следующий() Цикл
					ОбластьДополнительныеРасходы.Параметры.Заполнить(ВыборкаДополнительныеРасходы);
					ОбщийМодульСервисСервер.ЗаменитьСвоиЗначенияПараметровПечати(ОбластьДополнительныеРасходы);
					ДокументДляПечати.Вывести(ОбластьДополнительныеРасходы, ВыборкаДополнительныеРасходы.Уровень());
				КонецЦикла;	
			КонецЕсли;
			
			ВыборкаЗадействованныеСредства = Выборка.ЗадействованныеСредства.Выбрать();
			Если НЕ ВыборкаЗадействованныеСредства.Количество() = 0 Тогда
				ОбщийМодульСервисСервер.ЗаменитьСвоиЗначенияПараметровПечати(ОбластьЗадействованныеСредстваШапка);
				ДокументДляПечати.Вывести(ОбластьЗадействованныеСредстваШапка);
				
				Пока ВыборкаЗадействованныеСредства.Следующий() Цикл
					ОбластьЗадействованныеСредства.Параметры.Заполнить(ВыборкаЗадействованныеСредства);
					ОбщийМодульСервисСервер.ЗаменитьСвоиЗначенияПараметровПечати(ОбластьЗадействованныеСредства);
					ДокументДляПечати.Вывести(ОбластьЗадействованныеСредства, ВыборкаЗадействованныеСредства.Уровень());
				КонецЦикла;	
			КонецЕсли;
			
			ВыборкаМатериалы = Выборка.Материалы.Выбрать();
			Если НЕ ВыборкаМатериалы.Количество() = 0 Тогда
				ОбщийМодульСервисСервер.ЗаменитьСвоиЗначенияПараметровПечати(ОбластьМатериалыШапка);
				ДокументДляПечати.Вывести(ОбластьМатериалыШапка);
				
				Пока ВыборкаМатериалы.Следующий() Цикл
					ОбластьМатериалы.Параметры.Заполнить(ВыборкаМатериалы);
					ОбщийМодульСервисСервер.ЗаменитьСвоиЗначенияПараметровПечати(ОбластьМатериалы);
					ДокументДляПечати.Вывести(ОбластьМатериалы, ВыборкаМатериалы.Уровень());
				КонецЦикла;	
			КонецЕсли;
			
			ВыборкаРаботы = Выборка.Работы.Выбрать();
			Если НЕ ВыборкаРаботы.Количество() = 0 Тогда
				ОбщийМодульСервисСервер.ЗаменитьСвоиЗначенияПараметровПечати(ОбластьРаботыШапка);
				ДокументДляПечати.Вывести(ОбластьРаботыШапка);
				
				Пока ВыборкаРаботы.Следующий() Цикл
					ОбластьРаботы.Параметры.Заполнить(ВыборкаРаботы);
					ОбщийМодульСервисСервер.ЗаменитьСвоиЗначенияПараметровПечати(ОбластьРаботы);
					ДокументДляПечати.Вывести(ОбластьРаботы, ВыборкаРаботы.Уровень());
				КонецЦикла;	
			КонецЕсли;
			
			ВыборкаТовары = Выборка.Товары.Выбрать();
			Если НЕ ВыборкаТовары.Количество() = 0 Тогда
				ОбщийМодульСервисСервер.ЗаменитьСвоиЗначенияПараметровПечати(ОбластьТоварыШапка);
				ДокументДляПечати.Вывести(ОбластьТоварыШапка);
				
				Пока ВыборкаТовары.Следующий() Цикл
					ОбластьТовары.Параметры.Заполнить(ВыборкаТовары);
					ОбщийМодульСервисСервер.ЗаменитьСвоиЗначенияПараметровПечати(ОбластьТовары);
					ДокументДляПечати.Вывести(ОбластьТовары, ВыборкаТовары.Уровень());
				КонецЦикла;	
			КонецЕсли;
			
			Подвал.Параметры.Заполнить(Выборка);
			ОбщийМодульСервисСервер.ЗаменитьСвоиЗначенияПараметровПечати(Подвал);
			ДокументДляПечати.Вывести(Подвал);
			
			ВставлятьРазделительСтраниц = ИСТИНА;
		КонецЦикла;	
	КонецЕсли;
	
КонецПроцедуры

#КонецЕсли