//sza131119-2321 
//sza101207-1702      
//sza101204-2121      
//sza101117-1723       
//sza101117-0116       
//sza101116-1320       
&НаКлиенте
Процедура ЗакрытьФорму(Команда)
	ЭтаФорма.Закрыть();
КонецПроцедуры

&НаКлиенте
Процедура ОбработкаОповещения(ИмяСобытия, Параметр, Источник)
	
	Если ИмяСобытия = "ЧислоОбъектовДляОбработки" Тогда
		ЧислоОбъектовДляОбработки = Параметр;
		
	ИначеЕсли ИмяСобытия = "ПроцентОбработки" Тогда
		ПроцентОбработки = Параметр;
		
	ИначеЕсли ИмяСобытия = "ВремяОбработки" И Параметр Тогда
		ВремяОбработкиЧасть = ОбщийМодульСервисСервер.ПользователяТекущаяДата() - ДатаНачала;
		ВремяОбработки = СокрЛП(ВремяОбработкиЧасть) + " с.";
		ВремяОбработкиЧасть = ВремяОбработкиЧасть / ПроцентОбработки * 100;
		ДатаОкончания = ДатаНачала + ВремяОбработкиЧасть;
		
	ИначеЕсли ИмяСобытия = "ЧислоОбработанныхОбъектов" ТОгда
		ЧислоОбработанныхОбъектов = Параметр;
		
	ИначеЕсли ИмяСобытия = "ОбработанОбъект" Тогда
		ОбработанОбъект = СокрЛП(Параметр);
		НоваСтрокаТаблицы = ТаблицаОбработанныхОбъектов.Добавить();
		НоваСтрокаТаблицы.ОбработанОбъект = Параметр;
		
	ИначеЕсли ИмяСобытия = "ЗакрытьФормуПрогресса" И Параметр ТОгда
		ЭтаФорма.Закрыть();
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ПриЗакрытии()
	ОбщийМодульКлиент.СобытиеФормы(ЭтаФорма, 1);
КонецПроцедуры

&НаКлиенте
Процедура ПриОткрытии(Отказ)                                                                    // ПРИ ОТКРЫТИИ	
	
	ОбщийМодульКлиент.СобытиеФормы(ЭтаФорма, 0);
	ЭтаФорма.ОбновитьОтображениеДанных();
	
КонецПроцедуры

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)          // ПРИ СОЗДАНИИ НА СЕРВЕРЕ
	
	Если ЗначениеЗаполнено(Параметры.ДанныеПрогресса) Тогда
		ЭтаФорма.Заголовок = Параметры.ДанныеПрогресса.ЗаголовокФормы;
		ДатаНачала = Параметры.ДанныеПрогресса.ДатаНачала;
		Если Параметры.ДанныеПрогресса.НачальноеОкно ТОгда
			Элементы.ЗакрытьФорму.Видимость = ЛОЖЬ;
			Элементы.ОбработаныОбъекты.Видимость = ЛОЖЬ;
			Элементы.ДатаОкончания.Видимость = ЛОЖЬ;
			Элементы.ВремяОбработки.Видимость = ЛОЖЬ;
			ЭтаФорма.Заголовок = ЭтаФорма.Заголовок + " продолжается..";
			Элементы.Ожидайте.Видимость = ИСТИНА;
			Элементы.Ожидание.Видимость = ИСТИНА;
		Иначе
			Элементы.Ожидайте.Видимость = ЛОЖЬ;
			Элементы.Ожидание.Видимость = ЛОЖЬ;
			Элементы.ВремяПроизводства.Видимость = Параметры.ДанныеПрогресса.РасчитыватьСрокОкончанияОбмена;
			Элементы.ЗакрытьФорму.Видимость = Параметры.ДанныеПрогресса.НеЗакрыватьОкноПеречняОбъектовОбмена;
			Элементы.ОбработаныОбъекты.Видимость = Параметры.ДанныеПрогресса.ПоказыватьОбъектыОбмена;
			Элементы.ЗакрытьФорму.Видимость = Параметры.ДанныеПрогресса.НеЗакрыватьОкноПеречняОбъектовОбмена;
			ПроцентОбработки = Параметры.ДанныеПрогресса.ПроцентОбработки;
			ДатаОкончания = Параметры.ДанныеПрогресса.Датаокончания;
			ВремяОбработки = "" + Параметры.ДанныеПрогресса.ВремяОбработки + " с.";
			ОбработанОбъект = СокрЛП(Параметры.ДанныеПрогресса.ОбработанОбъект);
			Для Каждого ОбработанныйОбъект Из Параметры.ДанныеПрогресса.ТаблицаОбработанныхОбъектов Цикл
				НовыйОбработанныйОбъект = ТаблицаОбработанныхОбъектов.Добавить();	
				НовыйОбработанныйОбъект.ОбработанОбъект = ОбработанныйОбъект.Значение;
			КонецЦикла;
			ЧислоОбработанныхОбъектов = Параметры.ДанныеПрогресса.ЧислоОбработанныхОбъектов;
			ЧислоОбъектовДляОбработки = Параметры.ДанныеПрогресса.ЧислоОбъектовДляОбработки;	
		КонецЕсли;
	КонецЕсли;
КонецПроцедуры



