#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда

// sza140104-0214 :
// sza131111-0009 : 
Процедура ОбработкаПолученияПредставления(Данные, Представление, СтандартнаяОбработка)
	
	Если ОбщийМодульПовтор.ВывестиНаименованияНаДругомЯзыке() Тогда
		
		ВозможноеПредставление = ОбщийМодульПовтор.получитьПредставлениеНаЯзыке(Данные.ссылка, , ИСТИНА);
		Если НЕ ВозможноеПредставление = Неопределено Тогда
			Представление = ВозможноеПредставление;
			СтандартнаяОбработка = ЛОЖЬ;
		КонецЕсли;
	КонецЕсли;
	
КонецПроцедуры
Процедура Печать(ДокументДляПечати, Ссылка) Экспорт
	
	ДокументДляПечати.ИмяПараметровПечати  = "ПартияПриобретения" + СокрЛП(ИмяКомпьютера());
	ДокументДляПечати.КлючПараметровПечати = ДокументДляПечати.ИмяПараметровПечати;
	
	ДокументДляПечати.Очистить();
	
	СсылкаНаОбъектПечати = Ссылка[0];
	
	РазрядМетаданных = ""; ИмяМетаданных = "";
	ПроизвольнаяПечатнаяФорма = ОбщийМодульТекстСервер.ОпределитьПроизвольнуюПечатнуюФорму(, , СсылкаНаОбъектПечати, РазрядМетаданных, ИмяМетаданных);
	
	Если ЗначениеЗаполнено(ПроизвольнаяПечатнаяФорма) Тогда
		ДокументДляПечати = ОбщийМодульТекстСервер.СформироватьДокументПоПроизвольнойФорме(ПроизвольнаяПечатнаяФорма, , ДокументДляПечати, СсылкаНаОбъектПечати, РазрядМетаданных, ИмяМетаданных);
		
	Иначе		
		Макет = Справочники.ПартииПриобретения.ПолучитьМакет("Печать");
		Макет.КодЯзыкаМакета = ОбщийМодульПовтор.ПолучитьТекущийЯзыкДокументов();
		
		Запрос = Новый Запрос;
		Запрос.Текст = "ВЫБРАТЬ ПартииПриобретения.Дата,
		|	ВЫРАЗИТЬ(ПартииПриобретения.Комментарий КАК СТРОКА(1000)) КАК Комментарий,
		|	ПартииПриобретения.Наименование,
		|	ПартииПриобретения.ОбщаяСтоимостьПартии,
		|	ПартииПриобретения.Поставщик,
		|	ПартииПриобретения.ПроцентНаценки,
		|	ПартииПриобретения.СтоимостьТовара,
		|	ПартииПриобретения.СуммаДополнительнойСтоимости,
		|	ПартииПриобретения.СуммаДопРасходов,
		|	ПартииПриобретения.ПроцентыНаценкиПоПроизводителям.(
		|		НомерСтроки,
		|		Производитель,
		|		ПроцентНаценки,
		|		ОСтроке ),
		|	ПартииПриобретения.ДополнительныеРасходы.(
		|		НомерСтроки,
		|		Статья,
		|		Сумма,
		|		Валюта,
		|		Курс,
		|		ОСтроке )
		|ИЗ Справочник.ПартииПриобретения КАК ПартииПриобретения
		|ГДЕ ПартииПриобретения.Ссылка В (&Ссылка)";
		
		Запрос.Параметры.Вставить("Ссылка", Ссылка);
		Выборка = Запрос.Выполнить().Выбрать();
		
		ОбластьЗаголовок = Макет.ПолучитьОбласть("Заголовок");
		Шапка = Макет.ПолучитьОбласть("Шапка");
		ОбластьПроцентыНаценкиПоПроизводителямШапка = Макет.ПолучитьОбласть("ПроцентыНаценкиПоПроизводителямШапка");
		ОбластьПроцентыНаценкиПоПроизводителям = Макет.ПолучитьОбласть("ПроцентыНаценкиПоПроизводителям");
		ОбластьДополнительныеРасходыШапка = Макет.ПолучитьОбласть("ДополнительныеРасходыШапка");
		ОбластьДополнительныеРасходы = Макет.ПолучитьОбласть("ДополнительныеРасходы");
		Подвал = Макет.ПолучитьОбласть("Подвал");
		
		ВставлятьРазделительСтраниц = ЛОЖЬ;
		Пока Выборка.Следующий() Цикл
			Если ВставлятьРазделительСтраниц Тогда
				ДокументДляПечати.ВывестиГоризонтальныйРазделительСтраниц();
			КонецЕсли;
			
			ОбщийМодульСервисСервер.ЗаменитьСвоиЗначенияПараметровПечати(ОбластьЗаголовок);
			ДокументДляПечати.Вывести(ОбластьЗаголовок);
			
			Шапка.Параметры.Заполнить(Выборка);
			ОбщийМодульСервисСервер.ЗаменитьСвоиЗначенияПараметровПечати(Шапка);
			ДокументДляПечати.Вывести(Шапка, Выборка.Уровень());
			
			ВыборкаПроцентыНаценкиПоПроизводителям = Выборка.ПроцентыНаценкиПоПроизводителям.Выбрать();
			Если НЕ ВыборкаПроцентыНаценкиПоПроизводителям.количество() = 0 Тогда
				ОбщийМодульСервисСервер.ЗаменитьСвоиЗначенияПараметровПечати(ОбластьПроцентыНаценкиПоПроизводителямШапка);
				ДокументДляПечати.Вывести(ОбластьПроцентыНаценкиПоПроизводителямШапка);
				Пока ВыборкаПроцентыНаценкиПоПроизводителям.Следующий() Цикл
					ОбластьПроцентыНаценкиПоПроизводителям.Параметры.Заполнить(ВыборкаПроцентыНаценкиПоПроизводителям);
					ОбщийМодульСервисСервер.ЗаменитьСвоиЗначенияПараметровПечати(ОбластьПроцентыНаценкиПоПроизводителям);
					ДокументДляПечати.Вывести(ОбластьПроцентыНаценкиПоПроизводителям, ВыборкаПроцентыНаценкиПоПроизводителям.Уровень());
				КонецЦикла;                                                     	
			КонецЕсли;
			
			ВыборкаДополнительныеРасходы = Выборка.ДополнительныеРасходы.Выбрать();
			Если НЕ ВыборкаДополнительныеРасходы.Количество() = 0 Тогда
				ОбщийМодульСервисСервер.ЗаменитьСвоиЗначенияПараметровПечати(ОбластьДополнительныеРасходыШапка);
				ДокументДляПечати.Вывести(ОбластьДополнительныеРасходыШапка);
				Пока ВыборкаДополнительныеРасходы.Следующий() Цикл
					ОбластьДополнительныеРасходы.Параметры.Заполнить(ВыборкаДополнительныеРасходы);
					ОбщийМодульСервисСервер.ЗаменитьСвоиЗначенияПараметровПечати(ОбластьДополнительныеРасходы);
					ДокументДляПечати.Вывести(ОбластьДополнительныеРасходы, ВыборкаДополнительныеРасходы.Уровень());
				КонецЦикла;	
			КонецЕсли;
			
			Подвал.Параметры.Заполнить(Выборка);
			ОбщийМодульСервисСервер.ЗаменитьСвоиЗначенияПараметровПечати(Подвал);
			ДокументДляПечати.Вывести(Подвал);
			
			ВставлятьРазделительСтраниц = ИСТИНА;
		КонецЦикла;	
	КонецЕсли;
	
КонецПроцедуры

#КонецЕсли